{"version":3,"sources":["app/components/Actions/Actions.module.css","app/components/Status.module.css","app/components/CapStoryChart.module.css","app/components/EffectValue.module.css","app/components/Header.module.css","app/components/Content.module.css","app/components/Round/Round.module.css","lib/random.ts","lib/byProp.ts","lib/version.ts","lib/persistState.ts","lib/initialState.ts","lib/restartGame.ts","lib/getAllGameActions.ts","lib/findGameActionById.ts","state/effects/helpers.ts","state/rounds/getRoundEffects.ts","state/gameActions/getAvailableGameActions.ts","state/gameActions/getEffects.ts","state/gremlins.ts","state/game.ts","state/round.ts","state/gameActions/getCost.ts","lib/storySucceeds.ts","state/deriveAppState.ts","lib/useAppState.ts","lib/uiState.ts","lib/selectedActionIds.ts","app/components/CapStoryChart.tsx","app/components/Button.tsx","app/components/FinalResults.tsx","app/components/Round/Round.tsx","app/components/Round/Results.tsx","app/components/EffectValue.tsx","app/components/Round/Description.tsx","app/components/Round/Welcome.tsx","app/components/Actions/Overlay.tsx","app/components/Actions/ActionImage.tsx","lib/isGameActionWithImage.ts","app/components/Actions/Action.tsx","app/components/Actions/RoundActions.tsx","app/components/Actions/Actions.tsx","app/components/Status.tsx","app/components/Header.tsx","app/components/Rules.tsx","app/components/Content.tsx","app/components/Container.tsx","app/components/Log.tsx","app/components/Tabs.tsx","app/components/Rows.tsx","app/App.tsx","config/rounds/round1.tsx","config/rounds/round2.tsx","config/rounds/round3.tsx","config/rounds/round4.tsx","config/rounds/round5.tsx","config/rounds/index.ts","config/rounds/round6.tsx","config/rounds/round7.tsx","config/rounds/round8.tsx","config/gremlins/gremlins.tsx","config/index.ts","config/gameEffects/gameEffects.ts","index.tsx","app/components/Log.module.css","app/components/Tabs.module.css","app/components/Button.module.css","app/components/Container.module.css","app/components/Rows.module.css"],"names":["module","exports","random","Math","sumByProp","objects","key","sum","forEach","obj","concatByProp","all","push","hashCode","string","hash","length","toString","replace","i","charCodeAt","Promise","resolve","reject","a","process","TEAM_GAME_VERSION","fetch","response","text","LOCAL_STATE_KEY","GAME_STATE_OUTDATED","Symbol","GAME_STATE_OK","getSearchParams","Object","fromEntries","window","location","search","split","map","entry","parts","decodeURIComponent","localStateData","localStorage","getItem","restoreData","restore","data","JSON","parse","atob","versionP","version","state","config","restored","Date","parseInt","from","status","console","warn","currentRound","gremlin","selectedGameActionIds","pastRounds","ui","review","view","log","localState","useVersion","useState","setVersion","useEffect","canceled","then","v","catch","err","saveToLocalStorage","setItem","stringify","restartGame","dispatch","confirm","type","getAllGameActions","memoizeOne","rounds","round","entries","actions","actionId","action","id","flat","findGameActionById","gameActionId","gameAction","find","Error","isEffect","e","isVisibleEffect","title","getRoundEffects","currentRoundIndex","roundEffects","desc","previousRounds","slice","effect","Array","isArray","nextRoundEffect","nextRoundGremlinEffects","filter","undefined","gremlinChange","userStoryChange","capacityChange","concat","UNIQUE","getAvailableGameActions","finishedActionIds","allDependencies","req","available","requires","getDependencies","unmetDependencies","includes","dependencies","missing","times","unique","getEffects","age","fallbackTitle","name","getGremlinEffects","gremlins","getAllEffects","effects","initialScores","roundAmounts","getActionEffects","values","gameEffects","gameEffect","getCapacity","reduce","capacity","nextRound","payload","closedRound","getCosts","cost","closeRound","storiesAttempted","chance","storiesCompleted","storySucceeds","orZero","num","deriveAppRound","roundCapacity","visibleEffects","totalUserStoryChance","capacityAvailable","selectedGameActions","currentRoundTitle","currentRoundDescription","description","getGremlin","gremlinEffect","visibleGremlinEffects","number","total","gremlinChance","userStoryChance","activeEffects","deriveAppState","availableGameActions","gremlinArray","keys","pastGremlinIds","Boolean","newGremlinsWithProbability","currentProbability","probability","totalProbability","roll","shift","Infinity","rollGremlin","useAppState","initialState","appReducer","useMemo","gameReducer","trailingRounds","nextState","createGameReducer","uiStateReducer","game","assign","useReducer","gameState","usePersistState","link","getTime","origin","encodeURIComponent","btoa","useStateLink","selectedActionIds","before","selectedActions","stop","USC","SA","SC","TC","CapStoryChart","maxUserStoryChance","max","ceil","_","userStorySteps","className","styles","chart","height","width","margin","top","right","left","bottom","strokeDasharray","dataKey","yAxisId","orientation","unit","ticks","layout","fill","barSize","strokeWidth","legendType","stroke","Button","primary","rest","cx","button","Results","props","onClick","style","value","readOnly","ev","target","select","Round","totalRounds","welcome","results","userStoryEffects","userStoryChanceList","initialUserStoryChance","userStoryIcons","center","disabled","interactiveRounds","Sign","String","EffectValue","RoundDescription","children","gremlinEffects","Welcome","Overlay","referenceElement","onClose","overlayRef","useRef","popperElement","setPopperElement","handler","contains","addEventListener","removeEventListener","current","arrowElement","setArrowElement","popper","usePopper","placement","modifiers","options","offset","fallbackPlacements","element","data-popper-placement","ref","overlay","attributes","arrow","overlayInner","closeOverlay","overlayTitle","ActionImage","getOwnPropertyNames","actionImage","backgroundImage","image","actionIcon","icon","Action","buttonElement","setButtonElement","clickTimer","availableCapacity","clearTimeout","setTimeout","onOpen","onDoubleClick","onSelect","missingDep","actionSelected","actionFinished","isOpen","requiresTitle","requiresList","dep","RoundActions","actionsWithStatus","initialVisible","visible","setVisible","selected","roundVisibleToggle","roundActionList","actionWithStatus","openGameActionId","open","Actions","openActionId","setOpenActionId","showRounds","min","roundList","ActiveEffects","types","negative","showUnit","cap","negativeValue","Status","percentOnUserStories","userStoryStatus","capacityEffects","startCapacity","capThisRound","sign","userStoryWarning","userStoryCritical","Header","header","Rules","href","Content","content","Container","reviewHint","Log","roundsLog","actionList","Tabs","tabs","Tab","active","tab","tabActive","Rows","rows","Row","row","App","setTab","maxWidth","display","OutdatedStateWarning","setInitialState","configOverwrites","mergedConfig","textAlign","toLocaleString","round1","PROTECTED_FROM_OUTSIDE_DISTRACTION","CLARIFY_PRODUCT_VISION","WORKING_AGREEMENTS","BUILD_SERVER","TEAMS_ON_SAME_FLOOR","this","round2","REMOTE_TEAM_AVATARS","ELIMINATE_LONG_LIVED_FEATURE_BRANCHES","UNIT_TESTING","SOCIAL_TIME","PROBLEM_SOLVING_BONUS","change","BACKLOG_REFINEMENT","round3","IMPROVE_RETROSPECTIVES_CHANGE_AGENDA","OBSERVE_PEOPLE_AND_RELATIONSHIPS","ONE_ON_ONES","PAIR_PROGRAMMING","STORY_MAPPING_OR_OTHER","REFACTORING","round4","CROSS_SKILLING","EXTERNAL_CROSS_TRAINING","NEW_TESTER","resultDesc","LIMIT_WIP","TEST_DRIVEN_DEVELOPMENT","PERSONAL_PRODUCTIVITY_BONUS","round5","BYPASS_DEFINITION_OF_DONE","INCLUDE_STAKEHOLDERS_IN_VISION_UPDATE","ADOPT_BDD","WORK_WITH_PO_LIMIT_PB_SIZE","ESTABLISH_SPRINT_GOALS","MAKE_IMPEDIMENTS_LIST_PUBLIC","IMPROVE_FORECASTING","IMPROVE_RETROSPECTIVES_CONCRETE_ACTIONS","LEARNING_TIME","SPRINT_BACKLOG_IMPROVEMENT","DAILY_SCRUM_MORE_EFFECTIVE","ONE_PERSON_DEALS_WITH_DEFECTS","PREALLOCATE_CAPACITY_FOR_PRODUCTION_SUPPORT","GREMLIN_MANAGEMENT_YELLS","GREMLIN_EMERGENCY_ON_OTHER_TEAM","GREMLIN_NOT_PULLING_THEIR_WEIGHT","GREMLIN_NOT_AT_DAILY_SCRUM","GREMLIN_NEW_STORY_MID_SPRINT","GREMLIN_PRODUCT_BACKLOG_MESS","additionalComment","GREMLIN_SKIP_RETRO","GREMLIN_POOR_QUALITY","GREMLIN_UNREADABLE_CODE","technicalDebtDrag","roundsWithoutEngAction","roundConfigs","communicationDebtDrag","roundsWithoutCommunicationAction","getInitialState","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.f156b49a.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"roundList\":\"Actions_roundList__FT85P\",\"roundVisibleToggle\":\"Actions_roundVisibleToggle__MjixA\",\"roundActionList\":\"Actions_roundActionList__18V8A\",\"action\":\"Actions_action__1BFxZ\",\"disabled\":\"Actions_disabled__Ock2-\",\"missingDep\":\"Actions_missingDep__2UpJF\",\"actionImage\":\"Actions_actionImage__gDEyK\",\"actionIcon\":\"Actions_actionIcon__277pD\",\"actionSelected\":\"Actions_actionSelected__CM0eb\",\"actionFinished\":\"Actions_actionFinished__2nBgo\",\"arrow\":\"Actions_arrow__17BYl\",\"overlay\":\"Actions_overlay__18XyY\",\"overlayInner\":\"Actions_overlayInner__2pQwZ\",\"closeOverlay\":\"Actions_closeOverlay__2-IHn\",\"overlayTitle\":\"Actions_overlayTitle__anS1y\",\"requiresTitle\":\"Actions_requiresTitle__21j7E\",\"requiresList\":\"Actions_requiresList__2tbP1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"cap\":\"Status_cap__5WD6W\",\"sign\":\"Status_sign__9Lcv_\",\"status\":\"Status_status__hbTbz\",\"title\":\"Status_title__2fp8M\",\"capThisRound\":\"Status_capThisRound__EWSwY\",\"userStoryWarning\":\"Status_userStoryWarning__1JqE3\",\"userStoryCritical\":\"Status_userStoryCritical__2TSt0\",\"negative\":\"Status_negative__3uPyV\",\"negativeValue\":\"Status_negativeValue__2wqci\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"chart\":\"CapStoryChart_chart__10VPg\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"value\":\"EffectValue_value__1X_Qt\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__2YTYP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"Content_content__2_f3K\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"number\":\"Round_number__1TAJl\",\"title\":\"Round_title__21wBY\",\"description\":\"Round_description__251ua\",\"center\":\"Round_center__3PzoM\",\"userStoryIcons\":\"Round_userStoryIcons__195jj\",\"userStoryDescription\":\"Round_userStoryDescription__3ddG_\",\"userStoryChanceList\":\"Round_userStoryChanceList__1zKhp\",\"gremlinEffects\":\"Round_gremlinEffects__YC6mG\"};","export function random() {\n  return Math.random();\n}\n","type NonUndefined<A> = A extends undefined ? never : A;\ntype NumberKeys<T extends object> = {\n  [K in keyof T]-?: NonUndefined<T[K]> extends number ? K : never;\n}[keyof T];\ntype ArrayKeys<T extends object> = {\n  [K in keyof T]-?: NonUndefined<T[K]> extends any[] ? K : never;\n}[keyof T];\n\nexport function sumByProp<T extends object>(\n  objects: T[],\n  key: NumberKeys<T>,\n): number {\n  let sum = 0;\n  objects.forEach((obj) => {\n    sum += (obj as any)[key] || 0;\n  });\n  return sum;\n}\n\nexport function concatByProp<T extends object, K extends ArrayKeys<T>>(\n  objects: T[],\n  key: K,\n): T[K] {\n  const all: any = [];\n  objects.forEach((obj) => {\n    all.push(...obj[key]);\n  });\n  return all;\n}\n","/* https://stackoverflow.com/a/8831937 */\nfunction hashCode(string: string) {\n  var hash = 0;\n  if (string.length === 0) {\n    return hash.toString(36).replace(/^-/, '');\n  }\n  for (var i = 0; i < string.length; i++) {\n    var char = string.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash;\n  }\n  return hash.toString(36).replace(/^-/, '');\n}\n\nexport default new Promise<string>(async (resolve, reject) => {\n  if (process.env.TEAM_GAME_VERSION) {\n    resolve(process.env.TEAM_GAME_VERSION);\n    return;\n  }\n\n  if (process.env.NODE_ENV === 'test') {\n    resolve('test');\n    return;\n  }\n  try {\n    const response = await fetch('/asset-manifest.json');\n    resolve(hashCode(await response.text()));\n  } catch (err) {\n    reject(err);\n  }\n});\n","import { useEffect, useState } from 'react';\nimport { OverwritableConfig } from '../state';\nimport type { AppBaseState } from '../lib';\nimport { createInitialState } from './initialState';\nimport versionP from './version';\n\nconst LOCAL_STATE_KEY = 'TEAM_GAME_STATE';\nexport const GAME_STATE_OUTDATED = Symbol('GAME_STATE_OUTDATED');\nexport const GAME_STATE_OK = Symbol('GAME_STATE_OK');\nexport type InitialStateWithStatus = {\n  state: AppBaseState;\n  config: OverwritableConfig;\n  restored?: Date;\n  status: typeof GAME_STATE_OUTDATED | typeof GAME_STATE_OK;\n};\n\nfunction getSearchParams() {\n  return Object.fromEntries(\n    window.location.search\n      .replace(/^\\?/, '')\n      .split('&')\n      .map((entry) => {\n        const parts = entry.split('=');\n        return [decodeURIComponent(parts[0]), decodeURIComponent(parts[1])];\n      }),\n  );\n}\n\nexport async function getInitialState(): Promise<InitialStateWithStatus> {\n  const localStateData = localStorage.getItem(LOCAL_STATE_KEY);\n  const search = getSearchParams();\n  const restoreData: string | undefined = search.restore;\n\n  if (restoreData) {\n    try {\n      const data = JSON.parse(atob(restoreData));\n      const version = await versionP;\n      const state = typeof data.state === 'object' ? data.state : data;\n      const config = typeof data.config === 'object' ? data.config : {};\n      return {\n        state,\n        config,\n        restored: new Date(parseInt(search.from, 10)),\n        status:\n          search.version !== version ? GAME_STATE_OUTDATED : GAME_STATE_OK,\n      };\n    } catch (err) {\n      console.warn(err);\n    }\n  }\n\n  if (localStateData === null) {\n    return { state: createInitialState(), config: {}, status: GAME_STATE_OK };\n  }\n\n  try {\n    const localState = JSON.parse(localStateData);\n    const version = await versionP;\n\n    return {\n      state: localState.state,\n      config: typeof localState.config === 'object' ? localState.config : {},\n      status:\n        localState.version !== version ? GAME_STATE_OUTDATED : GAME_STATE_OK,\n    };\n  } catch (err) {\n    console.warn(err);\n    return { state: createInitialState(), config: {}, status: GAME_STATE_OK };\n  }\n}\n\nexport function useVersion() {\n  const [version, setVersion] = useState<string | null>(\n    process.env.NODE_ENV === 'test' ? 'test' : null,\n  );\n  useEffect(() => {\n    if (process.env.NODE_ENV === 'test') {\n      return;\n    }\n\n    let canceled = false;\n    versionP\n      .then((v) => {\n        if (canceled) {\n          return;\n        }\n        setVersion(v);\n      })\n      .catch((err) => {\n        if (canceled) {\n          return;\n        }\n        console.warn(err);\n      });\n\n    return () => {\n      canceled = true;\n    };\n  }, []);\n\n  return version;\n}\n\nexport function useStateLink(\n  state: AppBaseState,\n  from: number = new Date().getTime(),\n  config: OverwritableConfig = {},\n) {\n  const version = useVersion();\n\n  return `${window.location.origin}?restore=${encodeURIComponent(\n    btoa(JSON.stringify({ state, config })),\n  )}${\n    version ? `&version=${encodeURIComponent(version)}` : ''\n  }&from=${encodeURIComponent(from)}`;\n}\n\nexport function saveToLocalStorage(\n  state: AppBaseState,\n  version: string,\n  config: OverwritableConfig = {},\n) {\n  localStorage.setItem(\n    LOCAL_STATE_KEY,\n    JSON.stringify({ version, state, config }),\n  );\n}\n\nexport function usePersistState(state: AppBaseState) {\n  const version = useVersion();\n  useEffect(() => {\n    if (version) {\n      saveToLocalStorage(state, version);\n    }\n  }, [state, version]);\n}\n","import type { AppBaseState } from './useAppState';\n\nexport function createInitialState<\n  GameActionId extends string,\n  GremlinId extends string\n>(): AppBaseState<GameActionId, GremlinId> {\n  return {\n    currentRound: {\n      gremlin: null,\n      selectedGameActionIds: [],\n    },\n    pastRounds: [],\n    ui: {\n      review: false,\n      view: 'welcome',\n    },\n    log: [],\n  };\n}\n","import { GameDispatch } from './useAppState';\n\nexport function restartGame(dispatch: GameDispatch) {\n  return () => {\n    if (\n      window.confirm(\n        'Do you really want to start a new Game? You can not come back to this one afterwards.',\n      )\n    ) {\n      dispatch({ type: 'RESTART_GAME' });\n    }\n  };\n}\n","import memoizeOne from 'memoize-one';\nimport { GameConfig, GameAction } from '../state/game';\n\nexport const getAllGameActions = memoizeOne(\n  <GameActionId extends string, GremlinId extends string>(\n    rounds: GameConfig<GameActionId, GremlinId>['rounds'],\n  ): GameAction<GameActionId>[] => {\n    return rounds\n      .map((round, i) => {\n        return Object.entries(round.actions).map(([actionId, action]) => ({\n          ...action,\n          round: i + 1,\n          id: actionId as GameActionId,\n        }));\n      })\n      .flat();\n  },\n);\n","import { getAllGameActions } from './getAllGameActions';\nimport type { GameAction, GameConfig } from '../state/game';\n\nexport function findGameActionById<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  gameActionId: GameActionId,\n  rounds: GameConfig<GameActionId, GremlinId>['rounds'],\n): GameAction<GameActionId> {\n  const gameActions = getAllGameActions(rounds);\n\n  const gameAction = gameActions.find(\n    (gameAction) => gameActionId === gameAction.id,\n  );\n\n  if (!gameAction) {\n    throw new Error(\n      `Could not find GameAction with id ${gameActionId}. Are you sure it is registered?`,\n    );\n  }\n\n  return gameAction;\n}\n","import { Effect, VisibleEffect } from './types';\n\nexport function isEffect(e: Effect | null): e is Effect {\n  return e !== null;\n}\n\nexport function isVisibleEffect(e: Effect): e is VisibleEffect {\n  return e.title !== false;\n}\n","import { Effect, isEffect } from '../effects';\nimport { GameState, GameConfig } from '../game';\n\nexport function getRoundEffects<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  state: GameState<GameActionId, GremlinId>,\n  rounds: GameConfig<GameActionId, GremlinId>['rounds'],\n): Effect[] {\n  const currentRoundIndex = state.pastRounds.length;\n  const roundEffects: (null | Effect)[] = [];\n\n  for (let i = 0; i <= currentRoundIndex; i++) {\n    const desc = rounds[i];\n    if (!desc) {\n      continue;\n    }\n    const previousRounds = state.pastRounds.slice(0, i);\n    const effect = desc.effect?.(previousRounds, currentRoundIndex + 1) || null;\n\n    if (Array.isArray(effect)) {\n      roundEffects.push(...effect);\n    } else {\n      roundEffects.push(effect);\n    }\n  }\n\n  /* Since gremlins are rolled at the end of previous round we need to look\n   * at the next rounds effect for gremlin modification */\n  const nextRoundEffect =\n    rounds[currentRoundIndex + 1]?.effect?.(\n      [...state.pastRounds, state.currentRound],\n      currentRoundIndex + 1,\n    ) || [];\n  const nextRoundEffects = Array.isArray(nextRoundEffect)\n    ? nextRoundEffect\n    : [nextRoundEffect];\n  const nextRoundGremlinEffects = nextRoundEffects\n    .filter((effect) => effect.gremlinChange !== undefined)\n    .map((effect) => ({\n      ...effect,\n      /* Next rounds userStoryChange and capacityChange must not be active this round */\n      userStoryChange: undefined,\n      capacityChange: undefined,\n    }));\n\n  return roundEffects.filter(isEffect).concat(nextRoundGremlinEffects);\n}\n","import { GameAction } from './types';\nimport { getAllGameActions } from '../../lib/getAllGameActions';\nimport { findGameActionById } from '../../lib/findGameActionById';\nimport { GameConfig } from '../game';\n\nexport const UNIQUE = Symbol('UNIQUE');\n\ntype Times = typeof UNIQUE | number;\ntype GameActionStatus<GameActionId extends string> = {\n  dependencies: (GameAction<GameActionId> & { missing: boolean })[];\n} & (\n  | { type: 'MISSING_DEP' }\n  | { type: 'AVAILABLE'; times: Times }\n  | { type: 'SELECTED'; times: Times }\n  | { type: 'FINISHED' }\n);\n\nfunction getDependencies<GameActionId extends string>(\n  gameAction: GameAction<GameActionId>,\n): GameActionId[] {\n  const req = gameAction.available?.requires;\n  if (!req) {\n    return [];\n  }\n  if (!Array.isArray(req)) {\n    return [req];\n  }\n  return req;\n}\n\nexport type GameActionWithStatus<GameActionId extends string = string> = {\n  gameAction: GameAction<GameActionId>;\n  status: GameActionStatus<GameActionId>;\n};\n\nexport function getAvailableGameActions<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  currentRoundIndex: number,\n  finishedActionIds: GameActionId[],\n  selectedGameActionIds: GameActionId[],\n  rounds: GameConfig<GameActionId, GremlinId>['rounds'],\n): GameActionWithStatus<GameActionId>[] {\n  return getAllGameActions(rounds)\n    .map((gameAction): GameActionWithStatus<GameActionId> | null => {\n      if (currentRoundIndex + 1 < gameAction.round) {\n        return null;\n      }\n\n      const allDependencies = getDependencies(gameAction);\n      const unmetDependencies = allDependencies.filter(\n        (id) => !finishedActionIds.includes(id),\n      );\n      const dependencies = allDependencies\n        .map((id) => findGameActionById(id, rounds))\n        .map((gameAction) => ({\n          ...gameAction,\n          missing: unmetDependencies.includes(gameAction.id),\n        }));\n\n      if (unmetDependencies.length) {\n        return {\n          gameAction,\n          status: {\n            type: 'MISSING_DEP',\n            dependencies,\n          },\n        };\n      }\n\n      const times =\n        gameAction.available?.unique === false\n          ? selectedGameActionIds.filter((id) => id === gameAction.id).length\n          : UNIQUE;\n\n      if (times === UNIQUE && finishedActionIds.includes(gameAction.id)) {\n        return {\n          gameAction,\n          status: { type: 'FINISHED', dependencies },\n        };\n      }\n\n      return {\n        gameAction,\n        status: selectedGameActionIds.includes(gameAction.id)\n          ? {\n              type: 'SELECTED',\n              times,\n              dependencies,\n            }\n          : { type: 'AVAILABLE', times, dependencies },\n      };\n    })\n    .filter((e): e is GameActionWithStatus<GameActionId> => e !== null);\n}\n","import { Effect } from '../effects';\nimport { findGameActionById } from '../../lib/findGameActionById';\nimport { GameConfig } from '../game';\n\nexport function getEffects<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  gameActionId: GameActionId,\n  age: number,\n  finishedActionIds: GameActionId[],\n  rounds: GameConfig<GameActionId, GremlinId>['rounds'],\n): Effect[] {\n  const gameAction = findGameActionById(gameActionId, rounds);\n  const effect = gameAction.effect?.(age, finishedActionIds) || null;\n  if (effect === null) {\n    return [];\n  }\n  if (Array.isArray(effect)) {\n    return effect;\n  }\n\n  const fallbackTitle: Effect['title'] = `${gameAction.name} active`;\n\n  return [\n    {\n      title: fallbackTitle,\n      ...effect,\n    } as Effect,\n  ];\n}\n","import { sumByProp, random } from '../lib';\nimport { ReactElement } from 'react';\nimport { Effect } from './effects';\nimport { GameConfig, GameState, getAllEffects } from './game';\nimport { GameRound } from './round';\n\nexport type GremlinDescription = {\n  name: string;\n  description?: ReactElement;\n};\ntype GremlinImplementation<\n  GameActionId extends string,\n  GremlinId extends string\n> = GremlinDescription & {\n  probability: (state: GameState<GameActionId, GremlinId>) => number;\n  effect: (\n    age: number,\n    state: Pick<\n      GameState<GameActionId, GremlinId>,\n      'currentRound' | 'pastRounds'\n    >,\n  ) => null | Effect | Effect[];\n};\nexport type GremlinList<\n  GremlinId extends string,\n  GameActionId extends string\n> = {\n  [K in GremlinId]: GremlinImplementation<GameActionId, GremlinId>;\n};\n\nexport function rollGremlin<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  state: GameState<GameActionId, GremlinId>,\n  config: GameConfig<GameActionId, GremlinId>,\n): GremlinId | null {\n  /* No gremlins in trailing rounds */\n  if (state.pastRounds.length + 1 >= config.rounds.length) {\n    return null;\n  }\n\n  const ids = Object.keys(config.gremlins) as GremlinId[];\n  const gremlinArray: (GremlinImplementation<GameActionId, GremlinId> & {\n    id: GremlinId;\n  })[] = ids.map((id) => ({\n    ...config.gremlins[id],\n    id,\n  }));\n\n  const allEffects = getAllEffects(state, config);\n  const gremlinChance = sumByProp(allEffects, 'gremlinChange');\n\n  if (random() * 100 > gremlinChance) {\n    return null;\n  }\n\n  const pastGremlinIds = [state.currentRound, ...state.pastRounds]\n    .map((round) => round.gremlin)\n    .filter((id: string | null): id is string => Boolean(id));\n\n  const newGremlinsWithProbability = gremlinArray\n    .map((gremlin) => ({\n      ...gremlin,\n      currentProbability: gremlin.probability(state),\n    }))\n    .filter(\n      (gremlin) =>\n        !pastGremlinIds.includes(gremlin.id) && gremlin.currentProbability > 0,\n    );\n\n  const totalProbability = sumByProp(\n    newGremlinsWithProbability,\n    'currentProbability',\n  );\n\n  if (totalProbability === 0) {\n    return null;\n  }\n\n  let roll = random() * totalProbability;\n  let gremlin = newGremlinsWithProbability.shift();\n  while (roll > (gremlin?.currentProbability || Infinity)) {\n    roll -= gremlin?.currentProbability || Infinity;\n    gremlin = newGremlinsWithProbability.shift();\n  }\n\n  return gremlin?.id || null;\n}\n\nexport function getGremlinEffects<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  round: GameRound<GameActionId, GremlinId>,\n  age: number,\n  gremlins: GremlinList<GremlinId, GameActionId>,\n  state: Pick<\n    GameState<GameActionId, GremlinId>,\n    'currentRound' | 'pastRounds'\n  >,\n): Effect[] {\n  if (round.gremlin) {\n    const effect = gremlins[round.gremlin].effect(age, state);\n    if (Array.isArray(effect)) {\n      return effect;\n    }\n    if (effect) {\n      return [effect];\n    }\n  }\n\n  return [];\n}\n\nexport function getGremlin<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  round: GameRound<GameActionId, GremlinId>,\n  gremlins: GremlinList<GremlinId, GameActionId>,\n):\n  | (GremlinDescription & GremlinImplementation<GameActionId, GremlinId>)\n  | undefined {\n  if (!round.gremlin) {\n    return;\n  }\n\n  return gremlins[round.gremlin];\n}\n","import { concatByProp } from '../lib';\nimport {\n  GameRound,\n  ClosedGameRound,\n  createRound,\n  closeRound,\n  getActionEffects,\n} from './round';\nimport { BaseEffect, Effect, GameEffect, isEffect } from './effects';\nimport { getRoundEffects } from './rounds';\nimport { getEffects } from './gameActions';\nimport { getGremlinEffects, GremlinList } from './gremlins';\nimport { RoundDescription } from './rounds/types';\nexport type { GameAction } from './gameActions';\n\nexport type GameState<\n  GameActionId extends string = string,\n  GremlinId extends string = string\n> = {\n  currentRound: GameRound<GameActionId, GremlinId>;\n  pastRounds: ClosedGameRound<GameActionId, GremlinId>[];\n  log: RunningGameAction<GameActionId, GremlinId>[];\n};\n\nexport type RestartGameAction = {\n  type: 'RESTART_GAME';\n};\nexport type SelectGameActionAction<GameActionId extends string> = {\n  type: 'SELECT_GAME_ACTION';\n  payload: GameActionId;\n};\nexport type UnselectGameActionAction<GameActionId extends string> = {\n  type: 'UNSELECT_GAME_ACTION';\n  payload: GameActionId;\n};\nexport type NextRoundAction<\n  GameActionId extends string,\n  GremlinId extends string\n> = {\n  type: 'NEXT_ROUND';\n  payload: {\n    closedRound: ClosedGameRound<GameActionId, GremlinId>;\n    gremlin: GremlinId | null;\n  };\n};\nexport type FinishGameAction<\n  GameActionId extends string,\n  GremlinId extends string\n> = {\n  type: 'FINISH_GAME';\n  payload: {\n    closedRound: ClosedGameRound<GameActionId, GremlinId>;\n  };\n};\nexport type GameActionAction<GameActionId extends string = string> =\n  | SelectGameActionAction<GameActionId>\n  | UnselectGameActionAction<GameActionId>;\ntype RunningGameAction<GameActionId extends string, GremlinId extends string> =\n  | GameActionAction<GameActionId>\n  | NextRoundAction<GameActionId, GremlinId>;\n\nexport type Action<GameActionId extends string, GremlinId extends string> =\n  | RunningGameAction<GameActionId, GremlinId>\n  | RestartGameAction\n  | FinishGameAction<GameActionId, GremlinId>;\n\nexport type GameConfig<\n  GameActionId extends string = string,\n  GremlinId extends string = string\n> = {\n  initialScores: BaseEffect;\n  trailingRounds: number;\n  rounds: RoundDescription<string, GameActionId, GremlinId>[];\n  gremlins: GremlinList<GremlinId, GameActionId>;\n  gameEffects: { [key: string]: GameEffect<GameActionId, GremlinId> };\n};\n\nexport type OverwritableConfig = Partial<\n  Pick<GameConfig, 'initialScores' | 'trailingRounds'>\n>;\n\nexport function getAllEffects<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  state: GameState<GameActionId, GremlinId>,\n  config: GameConfig<GameActionId, GremlinId>,\n  finishedActionIds: GameActionId[] = concatByProp(\n    state.pastRounds,\n    'selectedGameActionIds',\n  ),\n) {\n  const effects: Effect[] = [{ title: false, ...config.initialScores }];\n\n  /* Base round effects of past rounds */\n  effects.push(...getRoundEffects(state, config.rounds));\n\n  /* Current rounds effects */\n  state.currentRound.selectedGameActionIds.forEach((id) => {\n    const currentRoundEffects = getEffects(\n      id,\n      0,\n      finishedActionIds,\n      config.rounds,\n    );\n\n    currentRoundEffects.forEach((effect) => {\n      if (\n        effect.userStoryChange !== undefined ||\n        effect.gremlinChange !== undefined\n      ) {\n        /* Unset capacityChange because it only gets active in next round */\n        effects.push({ ...effect, capacityChange: undefined });\n      }\n    });\n  });\n\n  /* current rounds gremlin */\n  effects.push(\n    ...getGremlinEffects(state.currentRound, 0, config.gremlins, state),\n  );\n\n  /* Get action and gremlin effects from past rounds */\n  const roundAmounts = state.pastRounds.length;\n  state.pastRounds.forEach((round, i) => {\n    const age = roundAmounts - i;\n\n    effects.push(\n      /* gremlins occur on current round, so they're at age +1 in next */\n      ...getGremlinEffects(round, age, config.gremlins, state),\n      /* actions get active in next */\n      ...getActionEffects(round, age, finishedActionIds, config.rounds).filter(\n        isEffect,\n      ),\n    );\n  });\n\n  /* Add game Effects */\n  Object.values(config.gameEffects).forEach((gameEffect) => {\n    const effect = gameEffect(state.pastRounds);\n    if (Array.isArray(effect)) {\n      effects.push(...effect);\n    } else if (effect) {\n      effects.push(effect);\n    }\n  });\n\n  return effects;\n}\n\nexport function getCapacity(effects: Effect[]) {\n  return effects.reduce((capacity, effect) => {\n    return capacity + (effect.capacityChange || 0);\n  }, 0);\n}\n\nfunction nextRound<GameActionId extends string, GremlinId extends string>(\n  state: GameState<GameActionId, GremlinId>,\n  action: NextRoundAction<GameActionId, GremlinId>,\n): GameState<GameActionId, GremlinId> {\n  return {\n    ...state,\n    pastRounds: [...state.pastRounds, action.payload.closedRound],\n    currentRound: createRound<GameActionId, GremlinId>(action.payload.gremlin),\n    log: state.log.concat(action),\n  };\n}\n\nexport function createGameReducer<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  config: GameConfig<GameActionId, GremlinId>,\n  initialState: GameState<GameActionId, GremlinId>,\n) {\n  return (\n    state: GameState<GameActionId, GremlinId>,\n    action: Action<GameActionId, GremlinId>,\n  ): GameState<GameActionId, GremlinId> => {\n    switch (action.type) {\n      case 'SELECT_GAME_ACTION': {\n        return {\n          ...state,\n          currentRound: {\n            ...state.currentRound,\n            selectedGameActionIds: [\n              ...state.currentRound.selectedGameActionIds,\n              action.payload,\n            ],\n          },\n          log: state.log.concat(action),\n        };\n      }\n      case 'UNSELECT_GAME_ACTION': {\n        return {\n          ...state,\n          currentRound: {\n            ...state.currentRound,\n            selectedGameActionIds: state.currentRound.selectedGameActionIds.filter(\n              (id) => id !== action.payload,\n            ),\n          },\n          log: state.log.concat(action),\n        };\n      }\n      case 'NEXT_ROUND': {\n        return nextRound(state, action);\n      }\n      case 'FINISH_GAME': {\n        return Array.from({\n          length:\n            config.rounds.length +\n            config.trailingRounds -\n            state.pastRounds.length,\n        }).reduce<\n          [\n            GameState<GameActionId, GremlinId>,\n            ClosedGameRound<GameActionId, GremlinId>,\n          ]\n        >(\n          ([state, closedRound]) => {\n            const nextState = nextRound(state, {\n              type: 'NEXT_ROUND',\n              payload: {\n                closedRound,\n                gremlin: null,\n              },\n            });\n\n            return [\n              nextState,\n              closeRound<GameActionId, GremlinId>(nextState, config),\n            ];\n          },\n          [state, action.payload.closedRound],\n        )[0];\n      }\n      case 'RESTART_GAME':\n        return initialState;\n    }\n  };\n}\n","import {\n  sumByProp,\n  storySucceeds,\n  concatByProp,\n  findGameActionById,\n} from '../lib';\nimport { GameState, getCapacity, getAllEffects, GameConfig } from './game';\nimport { getCost as getActionCost, getEffects } from './gameActions';\nimport { Effect, isEffect, isVisibleEffect, VisibleEffect } from './effects';\nimport { getGremlin, GremlinDescription } from './gremlins';\nimport { ReactNode } from 'react';\nimport { GameAction } from './gameActions/types';\n\nexport type GameRound<GameActionId extends string, GremlinId extends string> = {\n  gremlin: GremlinId | null;\n  selectedGameActionIds: GameActionId[];\n};\nexport type ClosedGameRound<\n  GameActionId extends string = string,\n  GremlinId extends string = string\n> = GameRound<GameActionId, GremlinId> & {\n  storiesCompleted: number;\n};\nexport type AppRound<GameActionId extends string = string> = {\n  number: number;\n  title?: string;\n  gremlin?: GremlinDescription & {\n    effect: VisibleEffect[];\n  };\n  description?: ReactNode;\n  selectedGameActions: GameAction<GameActionId>[];\n  capacity: {\n    available: number;\n    total: number;\n  };\n  gremlinChance: number;\n  userStoryChance: number;\n  activeEffects: VisibleEffect[];\n};\n\nexport function createRound<\n  GameActionId extends string = string,\n  GremlinId extends string = string\n>(gremlin: GremlinId | null): GameRound<GameActionId, GremlinId> {\n  return {\n    gremlin,\n    selectedGameActionIds: [],\n  };\n}\n\nexport function getActionEffects<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  round: ClosedGameRound<GameActionId, GremlinId>,\n  age: number,\n  finishedActionIds: GameActionId[],\n  rounds: GameConfig<GameActionId, GremlinId>['rounds'],\n): Effect[] {\n  const effects: Effect[] = [];\n  round.selectedGameActionIds.forEach((id) => {\n    effects.push(...getEffects(id, age, finishedActionIds, rounds));\n  });\n  return effects;\n}\n\nexport function getCosts<GameActionId extends string, GremlinId extends string>(\n  round: GameRound<GameActionId, GremlinId>,\n  rounds: GameConfig<GameActionId, GremlinId>['rounds'],\n) {\n  return sumByProp(\n    round.selectedGameActionIds.map((id) => ({\n      cost: getActionCost(findGameActionById(id, rounds)),\n    })),\n    'cost',\n  );\n}\n\nexport function closeRound<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  state: GameState<GameActionId, GremlinId>,\n  config: GameConfig<GameActionId, GremlinId>,\n): ClosedGameRound<GameActionId, GremlinId> {\n  const effects = getAllEffects(state, config);\n  const storiesAttempted =\n    getCapacity(effects) - getCosts(state.currentRound, config.rounds);\n\n  const chance = sumByProp(effects, 'userStoryChange');\n\n  return {\n    ...state.currentRound,\n    storiesCompleted:\n      storiesAttempted <= 0\n        ? 0\n        : Array.from({ length: storiesAttempted }).filter(() =>\n            storySucceeds(chance),\n          ).length,\n  };\n}\n\nfunction orZero(num: number): number {\n  return num < 0 ? 0 : num;\n}\n\nexport function deriveAppRound<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  state: GameState<GameActionId, GremlinId>,\n  config: GameConfig<GameActionId, GremlinId>,\n): AppRound<GameActionId> {\n  const finishedActionIds = concatByProp(\n    state.pastRounds,\n    'selectedGameActionIds',\n  );\n  const effects = getAllEffects(state, config, finishedActionIds);\n  const roundCapacity = orZero(getCapacity(effects));\n  const visibleEffects = effects.filter(isVisibleEffect);\n  const totalUserStoryChance = sumByProp(effects, 'userStoryChange');\n  const costs = getCosts(state.currentRound, config.rounds);\n  const capacityAvailable = orZero(roundCapacity - costs);\n  const currentRoundIndex = state.pastRounds.length;\n  const selectedGameActions = state.currentRound.selectedGameActionIds.map(\n    (id) => findGameActionById(id, config.rounds),\n  );\n  const currentRoundTitle = config.rounds[currentRoundIndex]?.title;\n  const currentRoundDescription = config.rounds[currentRoundIndex]?.description;\n  const gremlin = getGremlin(state.currentRound, config.gremlins);\n  const gremlinEffect = gremlin?.effect(0, state) || null;\n  const visibleGremlinEffects = (Array.isArray(gremlinEffect)\n    ? gremlinEffect\n    : [gremlinEffect]\n  )\n    .filter(isEffect)\n    .filter(isVisibleEffect);\n\n  return {\n    selectedGameActions,\n    title: currentRoundTitle,\n    description: currentRoundDescription,\n    gremlin: gremlin\n      ? {\n          name: gremlin.name,\n          description: gremlin.description,\n          effect: visibleGremlinEffects,\n        }\n      : undefined,\n    number: currentRoundIndex + 1,\n    capacity: {\n      available: capacityAvailable,\n      total: roundCapacity,\n    },\n    gremlinChance: sumByProp(effects, 'gremlinChange'),\n    userStoryChance: totalUserStoryChance,\n    activeEffects: visibleEffects,\n  };\n}\n","import { GameAction } from './types';\n\nexport function getCost<GameActionId extends string>(\n  gameAction: GameAction<GameActionId>,\n): number {\n  return gameAction.cost;\n}\n","import { random } from './random';\n\nexport function storySucceeds(chance: number) {\n  return random() * 100 < chance;\n}\n","import { concatByProp, UIState, AppBaseState } from '../lib';\nimport { GameConfig, GameState } from './game';\nimport { getAvailableGameActions } from './gameActions';\nimport { GameActionWithStatus } from './gameActions/getAvailableGameActions';\nimport { rollGremlin } from './gremlins';\nimport { AppRound, ClosedGameRound, closeRound, deriveAppRound } from './round';\n\ntype PastRound<GameActionId extends string> = AppRound<GameActionId> & {\n  storiesCompleted: number;\n};\n\nexport type AppState<\n  GameActionId extends string = string,\n  GremlinId extends string = string\n> = {\n  availableGameActions: GameActionWithStatus<GameActionId>[];\n  currentRound: AppRound<GameActionId>;\n  pastRounds: PastRound<GameActionId>[];\n  ui: UIState<GameActionId, GremlinId>;\n  log: GameState<GameActionId, GremlinId>['log'];\n};\n\nexport function deriveAppState<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  state: AppBaseState<GameActionId, GremlinId>,\n  config: GameConfig<GameActionId, GremlinId>,\n): [\n  AppState<GameActionId, GremlinId>,\n  () => ClosedGameRound<GameActionId, GremlinId>,\n  () => GremlinId | null,\n] {\n  const availableGameActions = getAvailableGameActions(\n    state.pastRounds.length,\n    concatByProp(state.pastRounds, 'selectedGameActionIds'),\n    state.currentRound.selectedGameActionIds,\n    config.rounds,\n  );\n\n  return [\n    {\n      availableGameActions,\n      currentRound: deriveAppRound(state, config),\n      pastRounds: state.pastRounds.map((round, i) => {\n        const pastRounds = state.pastRounds.slice(0, i);\n        const currentRound = state.pastRounds[i];\n\n        return {\n          ...deriveAppRound(\n            {\n              pastRounds,\n              currentRound,\n              log: state.log,\n            },\n            config,\n          ),\n          storiesCompleted: round.storiesCompleted,\n        };\n      }),\n      ui: state.ui,\n      log: state.log,\n    },\n    () => closeRound(state, config),\n    () => rollGremlin(state, config),\n  ];\n}\n","import { useMemo, useReducer, Dispatch } from 'react';\nimport type {\n  GameConfig,\n  GameState,\n  AppState,\n  Action,\n  ClosedRound,\n} from '../state';\nimport { createGameReducer, deriveAppState } from '../state';\nimport { usePersistState, useStateLink } from '../lib';\nimport { createInitialState } from './initialState';\nimport { uiStateReducer, UIState, UiAction } from './uiState';\n\nexport type AppBaseState<\n  GameActionId extends string = string,\n  GremlinId extends string = string\n> = GameState<GameActionId, GremlinId> & {\n  ui: UIState<GameActionId, GremlinId>;\n};\n\nexport type GameDispatch<\n  GameActionId extends string = string,\n  GremlinId extends string = string\n> = Dispatch<\n  Action<GameActionId, GremlinId> | UiAction<GameActionId, GremlinId>\n>;\n\nexport function useAppState<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  config: GameConfig<GameActionId, GremlinId>,\n  initialState: AppBaseState<GameActionId, GremlinId>,\n): [\n  AppState<GameActionId, GremlinId>,\n  () => ClosedRound<GameActionId, GremlinId>,\n  () => GremlinId | null,\n  string,\n  GameDispatch<GameActionId, GremlinId>,\n] {\n  const appReducer = useMemo(() => {\n    const gameReducer = createGameReducer(config, createInitialState());\n\n    return (\n      state: AppBaseState<GameActionId, GremlinId>,\n      action:\n        | UiAction<GameActionId, GremlinId>\n        | Action<GameActionId, GremlinId>,\n    ): AppBaseState<GameActionId, GremlinId> => {\n      /* We're deliberately passing unknown actions to the reducers knowing\n         that they'll return undefined for them which means nothing happened */\n      const ui = uiStateReducer(state.ui, action as any) || state.ui;\n      const game = gameReducer(state, action as any) || state;\n\n      return ui !== state.ui ? { ...game, ui } : Object.assign(game, { ui });\n    };\n  }, [config]);\n  const [gameState, dispatch] = useReducer(appReducer, initialState);\n  usePersistState(gameState);\n  const link = useStateLink(gameState);\n\n  const state: AppBaseState<GameActionId, GremlinId> =\n    gameState.ui.review === false\n      ? gameState\n      : {\n          currentRound: gameState.pastRounds[gameState.ui.review],\n          pastRounds: gameState.pastRounds.slice(0, gameState.ui.review),\n          ui: {\n            ...gameState.ui,\n            closedRound: gameState.pastRounds[gameState.ui.review],\n          },\n          log: gameState.log,\n        };\n\n  return [...deriveAppState(state, config), link, dispatch];\n}\n","import type { ClosedRound, NextRoundAction, RestartGameAction } from '../state';\n\nexport type UIState<\n  GameActionId extends string = string,\n  GremlinId extends string = string\n> = {\n  review: false | number;\n  view: 'welcome' | 'actions' | 'results';\n  closedRound?: ClosedRound<GameActionId, GremlinId>;\n};\n\nexport type SetUiReviewAction = {\n  type: 'SET_UI_REVIEW_ACTION';\n  payload: UIState['review'];\n};\nexport type SetUiViewAction = {\n  type: 'SET_UI_VIEW_ACTION';\n  payload: UIState['view'];\n};\nexport type SetUiClosedRoundAction<\n  GameActionId extends string,\n  GremlinId extends string\n> = {\n  type: 'SET_UI_CLOSED_ROUND_ACTION';\n  payload: ClosedRound<GameActionId, GremlinId>;\n};\nexport type UiAction<GameActionId extends string, GremlinId extends string> =\n  | SetUiViewAction\n  | SetUiClosedRoundAction<GameActionId, GremlinId>\n  | SetUiReviewAction;\n\nexport function uiStateReducer<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  state: UIState<GameActionId, GremlinId>,\n  action:\n    | UiAction<GameActionId, GremlinId>\n    | NextRoundAction<GameActionId, GremlinId>\n    | RestartGameAction,\n): UIState<GameActionId, GremlinId> {\n  switch (action.type) {\n    case 'SET_UI_VIEW_ACTION':\n      return {\n        ...state,\n        view: action.payload,\n      };\n    case 'SET_UI_CLOSED_ROUND_ACTION':\n      return {\n        ...state,\n        view: 'results',\n        closedRound: action.payload,\n      };\n    case 'SET_UI_REVIEW_ACTION':\n      return {\n        ...state,\n        view: 'welcome',\n        review: action.payload,\n      };\n    case 'NEXT_ROUND':\n      return {\n        ...state,\n        review: false,\n        view: 'welcome',\n        closedRound: undefined,\n      };\n    case 'RESTART_GAME':\n      return {\n        review: false,\n        view: 'welcome',\n        closedRound: undefined,\n      };\n  }\n}\n","import { ClosedRound, GameRound, GameState } from '../state';\nexport function selectedActionIds<\n  GameActionId extends string,\n  GremlinId extends string\n>(\n  state: Pick<\n    GameState<GameActionId, GremlinId>,\n    'currentRound' | 'pastRounds'\n  >,\n  before?: (\n    round:\n      | ClosedRound<GameActionId, GremlinId>\n      | GameRound<GameActionId, GremlinId>,\n  ) => boolean,\n) {\n  const selectedActions: GameActionId[] = [];\n  let stop = false;\n  for (let i = 0; i < state.pastRounds.length; i++) {\n    const round = state.pastRounds[i];\n    stop = before?.(round) || false;\n    if (stop) {\n      break;\n    } else {\n      selectedActions.push(...round.selectedGameActionIds);\n    }\n  }\n  if (!stop) {\n    selectedActions.push(...state.currentRound.selectedGameActionIds);\n  }\n\n  return selectedActions;\n}\n","import React, { useMemo } from 'react';\nimport {\n  ComposedChart,\n  Line,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n} from 'recharts';\nimport type { AppRound } from '../../state';\nimport styles from './CapStoryChart.module.css';\n\nconst USC = 'Chance of completing User Stories';\nconst SA = 'Total User Stories Attempted this round';\nconst SC = 'Total User Stories Completed this round';\nconst TC = 'Round Capacity';\n\ntype Data = {\n  name: string;\n  [USC]: number;\n  [TC]: number;\n  [SA]: number;\n  [SC]?: number;\n};\ntype Props = {\n  rounds: (AppRound & {\n    storiesCompleted: number | undefined;\n  })[];\n};\n\nexport default function CapStoryChart({ rounds }: Props) {\n  const [data, userStorySteps] = useMemo(() => {\n    const data: Data[] = [];\n    let maxUserStoryChance = 100;\n\n    rounds.forEach((round, i) => {\n      maxUserStoryChance = Math.max(\n        maxUserStoryChance,\n        Math.ceil(round.userStoryChance / 10) * 10,\n      );\n      data.push({\n        name: `Round ${i + 1}`,\n        [USC]: round.userStoryChance,\n        [TC]: round.capacity.total,\n        [SA]: round.capacity.available,\n        [SC]: round.storiesCompleted,\n      });\n    });\n    return [\n      data,\n      Array.from({ length: 1 + maxUserStoryChance / 10 }).map((_, i) => i * 10),\n    ];\n  }, [rounds]);\n\n  return (\n    <ResponsiveContainer className={styles.chart} height={300} width=\"100%\">\n      <ComposedChart\n        data={data}\n        margin={{\n          top: 5,\n          right: 30,\n          left: 20,\n          bottom: 5,\n        }}\n      >\n        <CartesianGrid strokeDasharray=\"3 3\" />\n        <XAxis dataKey=\"name\" />\n        <YAxis yAxisId=\"right\" orientation=\"right\" />\n        <YAxis\n          yAxisId=\"left\"\n          orientation=\"left\"\n          unit=\"%\"\n          ticks={userStorySteps}\n        />\n        <Tooltip />\n        <Legend layout=\"vertical\" />\n        <Bar\n          yAxisId=\"left\"\n          dataKey={USC}\n          fill=\"#e2d02f\"\n          unit=\"%\"\n          barSize={30}\n        />\n        <Line\n          yAxisId=\"right\"\n          type=\"monotone\"\n          dataKey={TC}\n          strokeWidth={3}\n          legendType=\"star\"\n          stroke=\"#0c79df\"\n        />\n        <Line yAxisId=\"right\" type=\"monotone\" dataKey={SA} stroke=\"#cd66e7\" />\n        <Line yAxisId=\"right\" type=\"monotone\" dataKey={SC} stroke=\"#1be400\" />\n      </ComposedChart>\n    </ResponsiveContainer>\n  );\n}\n","import React, { ButtonHTMLAttributes } from 'react';\nimport cx from 'classnames';\nimport styles from './Button.module.css';\n\ntype Props = ButtonHTMLAttributes<HTMLButtonElement> & {\n  primary?: boolean;\n};\n\nexport default function Button({ primary, className, ...rest }: Props) {\n  return (\n    <button\n      className={cx(className, styles.button, primary && styles.primary)}\n      {...rest}\n    />\n  );\n}\n","import React from 'react';\nimport type { AppState } from '../../state';\nimport { restartGame, sumByProp, GameDispatch } from '../../lib';\nimport CapStoryChart from './CapStoryChart';\nimport Button from './Button';\n\ntype Props = {\n  state: AppState;\n  link: string;\n  dispatch?: GameDispatch;\n};\n\nexport default function Results(props: Props) {\n  const storiesAttempted = sumByProp(\n    props.state.pastRounds.map((round) => ({\n      storiesAttempted: round.capacity.available,\n    })),\n    'storiesAttempted',\n  );\n  const storiesCompleted = sumByProp(\n    props.state.pastRounds,\n    'storiesCompleted',\n  );\n  const dispatch = props.dispatch;\n  return (\n    <>\n      <h2>Results</h2>\n      <ul>\n        <li>Final Capacity {props.state.currentRound.capacity.total}</li>\n        <li>Attempted {storiesAttempted} user stories</li>\n        <li>Completed {storiesCompleted} user stories</li>\n      </ul>\n      {dispatch && (\n        <>\n          <Button\n            onClick={() =>\n              dispatch({ type: 'SET_UI_REVIEW_ACTION', payload: 0 })\n            }\n          >\n            Review Game\n          </Button>\n          <Button primary onClick={restartGame(dispatch)}>\n            Start New Game\n          </Button>\n        </>\n      )}\n      <CapStoryChart rounds={props.state.pastRounds} />\n      <h3>Game Link</h3>\n      <p>\n        You can save or share this link. Opening it will restore this current\n        game.\n      </p>\n      <pre>\n        <input\n          style={{ width: '100%' }}\n          value={props.link}\n          readOnly\n          onClick={(ev) => (ev.target as HTMLInputElement).select()}\n        />\n      </pre>\n    </>\n  );\n}\n","import React, { ReactElement } from 'react';\nimport type { AppState } from '../../../state';\nimport styles from './Round.module.css';\n\ntype Props = Pick<AppState, 'currentRound' | 'ui'> & {\n  totalRounds: number;\n  welcome: ReactElement;\n  actions: ReactElement;\n  results?: ReactElement;\n};\n\nexport default function Round(props: Props) {\n  return (\n    <>\n      <h4 className={styles.number}>\n        Round {props.currentRound.number} of {props.totalRounds}\n      </h4>\n      {props.currentRound.title && (\n        <h2 className={styles.title}>{props.currentRound.title}</h2>\n      )}\n      {props.ui.view === 'welcome' && props.welcome}\n      {props.ui.view === 'actions' && props.actions}\n      {props.ui.view === 'results' && props.results}\n    </>\n  );\n}\n","import React from 'react';\nimport type { AppState, ClosedRound } from '../../../state';\nimport type { GameDispatch } from '../../../lib';\nimport Button from '../Button';\nimport CapStoryChart from '../CapStoryChart';\nimport styles from './Round.module.css';\n\ntype Props = Pick<AppState, 'ui' | 'pastRounds' | 'currentRound'> & {\n  closeRound: () => ClosedRound;\n  rollGremlin: () => string | null;\n  dispatch: GameDispatch;\n  initialUserStoryChance: number;\n  totalRounds: number;\n  interactiveRounds: number;\n};\nexport default function Results(props: Props) {\n  const userStoryEffects = props.currentRound.activeEffects.filter(\n    (effect) => effect.userStoryChange !== undefined,\n  );\n\n  return (\n    <>\n      <p>\n        What is the chance that each User Story will successfully be built?Life\n        is unpredictable but, based on the choices that you made for\n        Actions/Improvements, this is what we calculate your chances are for\n        successfully completing a user story.\n      </p>\n      <p>\n        Roll the dice to see how many User Stories you actually complete. When\n        you have reviewed the results click: “Begin Next Round\".\n      </p>\n      <h3>Calculation</h3>\n      <ul className={styles.userStoryChanceList}>\n        <li>&nbsp;&nbsp;&nbsp;{props.initialUserStoryChance}% base chance</li>\n        {userStoryEffects.map((effect) => (\n          <li key={effect.title}>\n            {effect.userStoryChange! > 0 ? '+' : '-'}{' '}\n            {effect.userStoryChange!.toString().replace(/^-/, '')}%{' '}\n            {effect.title}\n          </li>\n        ))}\n        <li>\n          = {props.currentRound.userStoryChance}% chance to successful finish\n          user-story\n        </li>\n        <li>---</li>\n        {!props.ui.closedRound && (\n          <>\n            <li>\n              x &nbsp; {props.currentRound.capacity.available} working capacity\n              that you elected to spend on user stories\n            </li>\n            <li>&nbsp;</li>\n          </>\n        )}\n        {props.ui.closedRound && (\n          <>\n            <li>\n              {props.currentRound.capacity.available} user stories attempted\n            </li>\n            <li>\n              {props.ui.closedRound.storiesCompleted} user stories completed\n            </li>\n          </>\n        )}\n      </ul>\n      <ul className={styles.userStoryIcons}>\n        {Array(props.currentRound.capacity.available)\n          .fill('')\n          .map((_, i) => (\n            <li key={i}>\n              {!props.ui.closedRound\n                ? '❓'\n                : i < props.ui.closedRound.storiesCompleted\n                ? '✅'\n                : '❌'}\n            </li>\n          ))}\n      </ul>\n      <div className={styles.center}>\n        {props.ui.review === false ? (\n          <Button\n            disabled={!!props.ui.closedRound}\n            onClick={() => {\n              props.dispatch({\n                type: 'SET_UI_CLOSED_ROUND_ACTION',\n                payload: props.closeRound(),\n              });\n            }}\n          >\n            Roll for User Stories\n          </Button>\n        ) : (\n          <Button\n            onClick={() => {\n              props.dispatch({\n                type: 'SET_UI_VIEW_ACTION',\n                payload: 'actions',\n              });\n            }}\n          >\n            ◀ Back\n          </Button>\n        )}\n        {props.pastRounds.length + 1 < props.totalRounds ? (\n          <Button\n            primary\n            disabled={!props.ui.closedRound}\n            onClick={() => {\n              if (props.ui.review !== false) {\n                props.dispatch({\n                  type: 'SET_UI_REVIEW_ACTION',\n                  payload: props.ui.review + 1,\n                });\n\n                return;\n              }\n\n              if (!props.ui.closedRound) {\n                throw new Error(\n                  'Can not go to next round without closing this one',\n                );\n              }\n\n              props.dispatch({\n                type: 'NEXT_ROUND',\n                payload: {\n                  closedRound: props.ui.closedRound,\n                  gremlin: props.rollGremlin(),\n                },\n              });\n            }}\n          >\n            Next Round\n          </Button>\n        ) : null}\n        {!props.ui.review &&\n        props.pastRounds.length + 1 >= props.interactiveRounds ? (\n          <Button\n            primary\n            disabled={!props.ui.closedRound}\n            onClick={() => {\n              if (!props.ui.closedRound) {\n                throw new Error(\n                  'Can not go to next round without closing this one',\n                );\n              }\n\n              props.dispatch({\n                type: 'FINISH_GAME',\n                payload: {\n                  closedRound: props.ui.closedRound,\n                },\n              });\n            }}\n          >\n            {props.pastRounds.length + 1 >= props.totalRounds\n              ? 'Finish Game'\n              : 'Finish Game (simulate remaining rounds)'}\n          </Button>\n        ) : null}\n        {props.ui.review && props.ui.review + 1 >= props.totalRounds ? (\n          <Button\n            primary\n            onClick={() => {\n              props.dispatch({\n                type: 'SET_UI_REVIEW_ACTION',\n                payload: false,\n              });\n            }}\n          >\n            Close Review\n          </Button>\n        ) : null}\n      </div>\n      <h3>Summary of all rounds</h3>\n      <p>The graph will make more sense and show the overall results of choices made, as more rounds get completed and are shown.</p>\n      <CapStoryChart\n        rounds={[\n          ...props.pastRounds,\n          {\n            ...props.currentRound,\n            storiesCompleted: props.ui.closedRound?.storiesCompleted,\n          },\n        ]}\n      />\n    </>\n  );\n}\n","import React from 'react';\nimport type { VisibleEffect } from '../../state';\nimport styles from './EffectValue.module.css';\n\ntype Props = {\n  effect: VisibleEffect;\n};\n\nexport function Sign(props: { value: number; unit?: string }) {\n  return (\n    <span className={styles.value}>\n      {props.value > 0 ? '+' : '-'}\n      {String(props.value).replace(/^-/, '')}\n      {props.unit}\n    </span>\n  );\n}\n\nexport default function EffectValue(props: Props) {\n  return (\n    <>\n      {props.effect.capacityChange !== undefined && (\n        <>\n          <Sign value={props.effect.capacityChange} /> Capacity\n        </>\n      )}\n      {props.effect.gremlinChange !== undefined && (\n        <>\n          <Sign value={props.effect.gremlinChange} unit=\"%\" /> Chance of\n          Gremlins occurring\n        </>\n      )}\n      {props.effect.userStoryChange !== undefined && (\n        <>\n          <Sign value={props.effect.userStoryChange} unit=\"%\" /> Chance of User\n          Stories succeeding\n        </>\n      )}\n    </>\n  );\n}\n","import React, { ReactNode } from 'react';\nimport type { AppState } from '../../../state';\nimport EffectValue from '../EffectValue';\nimport styles from './Round.module.css';\n\nexport type Props = {\n  children: ReactNode;\n  gremlin: AppState['currentRound']['gremlin'];\n};\nexport default function RoundDescription(props: Props) {\n  return (\n    <>\n      {props.children ? (\n        <div className={styles.description}>{props.children}</div>\n      ) : null}\n      {props.gremlin && (\n        <>\n          <h3>Gremlin</h3>\n          Just happened:&nbsp;\n          <strong>⚠️ {props.gremlin.name}</strong>\n          {props.gremlin.description}\n          <ul className={styles.gremlinEffects}>\n            {props.gremlin.effect.map((effect) => (\n              <li key={effect.title}>\n                <EffectValue effect={effect} />\n              </li>\n            ))}\n          </ul>\n        </>\n      )}\n    </>\n  );\n}\n","import React from 'react';\nimport type { GameDispatch } from '../../../lib';\nimport Button from '../Button';\nimport Description, { Props as DescriptionProps } from './Description';\nimport styles from './Round.module.css';\n\ntype Props = DescriptionProps & {\n  review: false | number;\n  dispatch: GameDispatch;\n  totalRounds: number;\n};\nexport default function Welcome(props: Props) {\n  const review = props.review;\n  return (\n    <>\n      <Description gremlin={props.gremlin}>{props.children}</Description>\n      <div className={styles.center}>\n        {review ? (\n          <Button\n            onClick={() => {\n              props.dispatch({\n                type: 'SET_UI_REVIEW_ACTION',\n                payload: review - 1,\n              });\n            }}\n          >\n            ◀ Round {review}\n          </Button>\n        ) : null}\n        <Button\n          primary\n          onClick={() => {\n            props.dispatch({ type: 'SET_UI_VIEW_ACTION', payload: 'actions' });\n          }}\n        >\n          {review === false ? 'Start Round' : 'Show Actions'}\n        </Button>\n        {review !== false && review + 1 < props.totalRounds ? (\n          <Button\n            onClick={() => {\n              props.dispatch({\n                type: 'SET_UI_REVIEW_ACTION',\n                payload: review + 1,\n              });\n            }}\n          >\n            Round {review + 2} ▶\n          </Button>\n        ) : null}\n      </div>\n    </>\n  );\n}\n","import React, { useState, useRef, useEffect, ReactNode } from 'react';\nimport { usePopper } from 'react-popper';\nimport styles from './Actions.module.css';\n\ntype Props = {\n  title: ReactNode;\n  children: ReactNode;\n  referenceElement: HTMLElement | null;\n  onClose: () => void;\n};\n\nexport default function Overlay(props: Props) {\n  const referenceElement = props.referenceElement;\n  const onClose = props.onClose;\n  const overlayRef = useRef<HTMLDivElement | null>(null);\n  const [popperElement, setPopperElement] = useState<HTMLDivElement | null>(\n    null,\n  );\n  useEffect(() => {\n    const handler = (ev: MouseEvent) => {\n      if (!popperElement || !ev.target) {\n        return;\n      }\n      if (!popperElement.contains(ev.target as any)) {\n        onClose();\n      }\n    };\n    window.addEventListener('click', handler);\n\n    return () => window.removeEventListener('click', handler);\n  }, [popperElement, onClose]);\n\n  overlayRef.current = popperElement;\n  const [arrowElement, setArrowElement] = useState<HTMLDivElement | null>(null);\n  const popper = usePopper(referenceElement, popperElement, {\n    placement: 'bottom-end',\n    modifiers: [\n      {\n        name: 'offset',\n        options: {\n          offset: [0, 8],\n        },\n      },\n      {\n        name: 'flip',\n        options: {\n          fallbackPlacements: [\n            'bottom',\n            'bottom-start',\n            'top-end',\n            'top',\n            'top-start',\n            'right',\n          ],\n        },\n      },\n      { name: 'preventOverflow' },\n      { name: 'arrow', options: { element: arrowElement } },\n    ],\n  });\n\n  return (\n    <div\n      data-popper-placement={popper.state?.placement}\n      ref={setPopperElement}\n      className={styles.overlay}\n      style={popper.styles.popper}\n      {...popper.attributes}\n    >\n      <div\n        ref={setArrowElement}\n        style={popper.styles.arrow}\n        className={styles.arrow}\n      />\n      <div className={styles.overlayInner}>\n        <button className={styles.closeOverlay} onClick={() => props.onClose()}>\n          ╳\n        </button>\n        <h3 className={styles.overlayTitle}>{props.title}</h3>\n        {props.children}\n      </div>\n    </div>\n  );\n}\n","import React, { HTMLAttributes } from 'react';\nimport cx from 'classnames';\nimport type { GameAction } from '../../../state';\nimport { isGameActionWithImage } from '../../../lib';\nimport styles from './Actions.module.css';\n\ntype Props = Omit<HTMLAttributes<HTMLSpanElement>, 'children'> & {\n  gameAction: GameAction;\n};\nexport default function ActionImage({\n  gameAction,\n  className,\n  style,\n  ...rest\n}: Props) {\n  if (isGameActionWithImage(gameAction)) {\n    return (\n      <span\n        className={cx(styles.actionImage, className)}\n        style={{ backgroundImage: `url(${gameAction.image})`, ...style }}\n        {...rest}\n      />\n    );\n  }\n\n  return (\n    <span className={cx(styles.actionIcon, className)} style={style} {...rest}>\n      {gameAction.icon}\n    </span>\n  );\n}\n","import type { GameAction, GameActionWithImage } from '../state';\n\nexport function isGameActionWithImage<GameActionId extends string>(\n  action: GameAction<GameActionId>,\n): action is GameActionWithImage<GameActionId> {\n  return Object.getOwnPropertyNames(action).includes('image');\n}\n","import React, { useRef, useState } from 'react';\nimport cx from 'classnames';\nimport type { GameActionWithStatus } from '../../../state';\nimport styles from './Actions.module.css';\nimport Overlay from './Overlay';\nimport Button from '../Button';\nimport ActionImage from './ActionImage';\n\ntype ActionProps = GameActionWithStatus & {\n  review: boolean;\n  isOpen: boolean;\n  availableCapacity: number;\n  onOpen: (open: boolean) => void;\n  onSelect: (selected: boolean) => void;\n};\n\nexport default function Action(props: ActionProps) {\n  const [buttonElement, setButtonElement] = useState<HTMLButtonElement | null>(\n    null,\n  );\n  const clickTimer = useRef<NodeJS.Timeout>();\n  const gameAction = props.gameAction;\n\n  const disabled =\n    props.review ||\n    (props.status.type === 'AVAILABLE' &&\n      gameAction.cost > props.availableCapacity) ||\n    ['MISSING_DEP', 'FINISHED'].includes(props.status.type);\n\n  return (\n    <>\n      <button\n        ref={setButtonElement}\n        onClick={() => {\n          if (clickTimer.current) {\n            clearTimeout(clickTimer.current);\n          }\n          clickTimer.current = setTimeout(() => props.onOpen(true), 300);\n        }}\n        onDoubleClick={() => {\n          if (disabled) {\n            return;\n          }\n          if (clickTimer.current) {\n            clearTimeout(clickTimer.current);\n          }\n          props.onSelect(props.status.type === 'AVAILABLE');\n        }}\n        className={cx(\n          styles.action,\n          disabled && !props.review && styles.disabled,\n          props.status.type === 'MISSING_DEP' && styles.missingDep,\n          props.status.type === 'SELECTED' && styles.actionSelected,\n          props.status.type === 'FINISHED' && styles.actionFinished,\n        )}\n      >\n        <ActionImage gameAction={props.gameAction} />\n        <span>{props.gameAction.name}</span>\n      </button>\n      {props.isOpen && (\n        <Overlay\n          referenceElement={buttonElement}\n          title={props.gameAction.name}\n          onClose={() => props.onOpen(false)}\n        >\n          {props.status.dependencies.length ? (\n            <>\n              <h4 className={styles.requiresTitle}>Requires</h4>\n              <ul className={styles.requiresList}>\n                {props.status.dependencies.map((dep) => (\n                  <li key={dep.id}>\n                    {dep.missing ? '❌' : '✅'} {dep.name}\n                  </li>\n                ))}\n              </ul>\n            </>\n          ) : null}\n          {props.gameAction.description}\n          <p>\n            <b>Cost</b>: {props.gameAction.cost}\n          </p>\n          {!disabled && (\n            <Button\n              primary={props.status.type === 'AVAILABLE'}\n              onClick={() => {\n                props.onOpen(false);\n                props.onSelect(props.status.type === 'AVAILABLE');\n              }}\n            >\n              {props.status.type === 'SELECTED' ? 'Remove' : 'Select'}\n            </Button>\n          )}\n          {disabled && props.status.type === 'FINISHED' && (\n            <Button primary disabled>\n              Finished\n            </Button>\n          )}\n        </Overlay>\n      )}\n    </>\n  );\n}\n","import React, { useState } from 'react';\nimport type { GameActionWithStatus } from '../../../state';\nimport styles from './Actions.module.css';\nimport Action from './Action';\n\ntype Props = {\n  round: number;\n  review: boolean;\n  initialVisible: boolean;\n  openGameActionId?: string;\n  availableCapacity: number;\n  onOpen: (open: boolean, id: string) => void;\n  onSelect: (selected: boolean, actionWithStatus: string) => void;\n  actionsWithStatus: GameActionWithStatus[];\n};\n\nexport default function RoundActions(props: Props) {\n  const [visible, setVisible] = useState(\n    () =>\n      /* Always show selected actions in review */\n      (props.review &&\n        props.actionsWithStatus.find(\n          ({ status: { type } }) => type === 'SELECTED',\n        )) ||\n      props.initialVisible,\n  );\n  const selected = props.actionsWithStatus.filter(\n    ({ status: { type } }) => type === 'FINISHED' || type === 'SELECTED',\n  ).length;\n\n  return (\n    <>\n      <li>\n        <button\n          className={styles.roundVisibleToggle}\n          onClick={() => setVisible(!visible)}\n        >\n          Round {props.round} {visible ? '▲' : '▼'}{' '}\n          <small>\n            ({selected}/{props.actionsWithStatus.length} actions selected)\n          </small>\n        </button>\n        {visible && (\n          <ul className={styles.roundActionList}>\n            {props.actionsWithStatus.map(\n              /* eslint-disable-next-line array-callback-return */\n              (actionWithStatus): JSX.Element => {\n                return (\n                  <li key={actionWithStatus.gameAction.id}>\n                    <Action\n                      {...actionWithStatus}\n                      review={props.review}\n                      availableCapacity={props.availableCapacity}\n                      isOpen={\n                        props.openGameActionId ===\n                        actionWithStatus.gameAction.id\n                      }\n                      onOpen={(open) =>\n                        props.onOpen(open, actionWithStatus.gameAction.id)\n                      }\n                      onSelect={(selected) =>\n                        props.onSelect(selected, actionWithStatus.gameAction.id)\n                      }\n                    />\n                  </li>\n                );\n              },\n            )}\n          </ul>\n        )}\n      </li>\n    </>\n  );\n}\n","import React, { useState, Fragment } from 'react';\nimport type {\n  AppState,\n  GameActionWithStatus,\n  GameConfig,\n} from '../../../state';\nimport type { GameDispatch } from '../../../lib';\nimport styles from './Actions.module.css';\nimport RoundActions from './RoundActions';\n\nfunction onlyRound(number: number) {\n  return (actionWithStatus: GameActionWithStatus): boolean =>\n    actionWithStatus.gameAction.round === number;\n}\n\ntype Props = {\n  rounds: GameConfig['rounds'];\n  currentRound: number;\n  ui: AppState['ui'];\n  availableGameActions: AppState['availableGameActions'];\n  dispatch: GameDispatch;\n  availableCapacity: number;\n};\n\nexport default function Actions(props: Props) {\n  const [openActionId, setOpenActionId] = useState<string>();\n\n  const showRounds = Math.min(props.currentRound, props.rounds.length);\n  return (\n    <>\n      <h2>Available Actions</h2>\n      <p>\n        Select Improvements or Actions that will affect the team. Once selected,\n        the Actions cost will be deducted from the team's Working Capacity.\n      </p>\n      <ul className={styles.roundList}>\n        {Array.from({ length: showRounds }).map((_, i) => {\n          const round = showRounds - i;\n          return (\n            <Fragment key={round}>\n              <RoundActions\n                review={props.ui.review !== false}\n                availableCapacity={props.availableCapacity}\n                onOpen={(open, actionId) => {\n                  setOpenActionId(open ? actionId : undefined);\n                }}\n                openGameActionId={openActionId}\n                onSelect={(selected, actionId) =>\n                  props.dispatch(\n                    selected\n                      ? {\n                          type: 'SELECT_GAME_ACTION',\n                          payload: actionId,\n                        }\n                      : {\n                          type: 'UNSELECT_GAME_ACTION',\n                          payload: actionId,\n                        },\n                  )\n                }\n                initialVisible={round === props.currentRound}\n                round={round}\n                actionsWithStatus={props.availableGameActions.filter(\n                  onlyRound(round),\n                )}\n              />\n              {i === 0 && showRounds > 1 ? (\n                <p>\n                  <em>\n                    Previous rounds actions are still available, click the\n                    &#9658; to open prior rounds.\n                  </em>\n                </p>\n              ) : null}\n            </Fragment>\n          );\n        })}\n      </ul>\n    </>\n  );\n}\n","import React from 'react';\nimport cx from 'classnames';\nimport type { AppState, BaseEffect } from '../../state';\nimport EffectValue, { Sign } from './EffectValue';\nimport styles from './Status.module.css';\n\ntype Props = AppState['currentRound'] & {\n  startCapacity: number;\n};\n\nexport function ActiveEffects(props: {\n  effects: AppState['currentRound']['activeEffects'];\n  types?: (keyof BaseEffect)[];\n  showUnit: boolean;\n}) {\n  return (\n    <>\n      {(\n        props.types || ['capacityChange', 'userStoryChange', 'gremlinChange']\n      ).map((type) =>\n        props.effects\n          .filter((effect) => effect[type] !== undefined)\n          .map((effect) => {\n            const value = effect[type]!;\n\n            return (\n              <li\n                key={effect.title}\n                className={cx(value < 0 && styles.negative)}\n              >\n                <span\n                  className={cx(\n                    !props.showUnit && styles.cap,\n                    value < 0 && styles.negativeValue,\n                  )}\n                >\n                  {props.showUnit ? (\n                    <EffectValue effect={effect} />\n                  ) : (\n                    <Sign value={value} />\n                  )}\n                </span>\n                {props.showUnit ? <br /> : ' '}\n                {effect.title}\n              </li>\n            );\n          }),\n      )}\n    </>\n  );\n}\n\nexport default function Status(props: Props) {\n  const percentOnUserStories = props.capacity.available / props.capacity.total;\n  const userStoryStatus =\n    percentOnUserStories < 0.5\n      ? 'CRITICAL'\n      : percentOnUserStories < 0.7\n      ? 'WARNING'\n      : 'OK';\n\n  const capacityEffects = props.activeEffects.filter(\n    (effect) => effect.capacityChange !== undefined,\n  );\n\n  return (\n    <>\n      <h2>Working Capacity Breakdown</h2>\n      <ul className={styles.status}>\n        <li>\n          <span className={styles.cap}>{props.startCapacity}</span> Start\n          Capacity\n        </li>\n        {capacityEffects.length ? (\n          <>\n            <li className={styles.title}>Active Effects</li>\n            <ActiveEffects\n              effects={capacityEffects}\n              types={['capacityChange']}\n              showUnit={false}\n            />\n          </>\n        ) : null}\n        <li className={styles.capThisRound}>\n          <span className={styles.cap}>\n            <span className={styles.sign}>=</span> {props.capacity.total}\n          </span>{' '}\n          Capacity available this round\n        </li>\n        {props.selectedGameActions.length !== 0 && (\n          <>\n            <li className={styles.title}>Selected Actions</li>\n            {props.selectedGameActions.map((gameAction) => (\n              <li key={gameAction.id}>\n                <span className={styles.cap}>\n                  <span className={styles.sign}>-</span> {gameAction.cost}\n                </span>\n                {gameAction.name}\n              </li>\n            ))}\n          </>\n        )}\n\n        <li className={styles.title}>User Stories</li>\n        <li\n          className={cx(\n            userStoryStatus === 'WARNING' && styles.userStoryWarning,\n            userStoryStatus === 'CRITICAL' && styles.userStoryCritical,\n          )}\n        >\n          <span className={styles.cap}>\n            <span className={styles.sign}>=</span> {props.capacity.available}\n          </span>{' '}\n          spent on User Stories\n        </li>\n        <li className={styles.title}>\n          {userStoryStatus === 'WARNING' && (\n            <>🧑‍💼: \"feature work needs more priority\"</>\n          )}\n          {userStoryStatus === 'CRITICAL' && (\n            <>🧑‍💼: \"not enough time spent on feature work\"</>\n          )}\n        </li>\n      </ul>\n    </>\n  );\n}\n","import React, { ReactNode } from 'react';\nimport styles from './Header.module.css';\n\ntype Props = {\n  children?: ReactNode;\n};\nexport default function Header(props: Props) {\n  return (\n    <div className={styles.header}>\n      <h1>High-Performance Team Game </h1>\n      {props.children}\n    </div>\n  );\n}\n","import React from 'react';\n\nexport default function Rules() {\n  return (\n    <>\n      <h2>Welcome</h2>\n      <p>\n        Reading about improvements rarely sparks the deeper changes that teams\n        need to be effective. This game exists so you can start to see the\n        choices a team has to improve.\n      </p>\n      <p>\n        In the longer term, the game is here to spark a discussion among your\n        real team about improvements they can make. To that end, the game is\n        best played in a single web browser where everyone can see what is\n        happening and discuss the options.<br></br>Some people have fun playing\n        the game by themselves.\n      </p>\n      <h3>Background</h3>\n      <p>\n        Your team is working on the World’s Smallest Online Bookstore, a site\n        that provides the best results (just a few) for every search, not every\n        result on earth. Your team is a software development team, focused on\n        driving more sales of the best books in the world.\n      </p>\n      <p>\n        Your team is part of a company being funded by a Vulture Capital - that\n        means, if you don’t deliver, our funding will be cut for the entire\n        company. Your goal is to build a high-performing team, while\n        delivering a meaningful ROI to our investors. You'll be faced with some\n        choices in each round, but remember: all the investors care about is the\n        delivery of features. You don't want to let them, your teammates, and\n        the company overall, down. \n      </p>\n      <p>\n        My goal is to help you see the effects of choices/tradeoffs on\n        productivity and team cohesion. While some of the benefits of Agile\n        happen at the individual level, there are many things that affect the\n        relationships between team members and, therefore, the overall cohesion\n        and productivity of the team. The game simulates a year in the life of a\n        team. Each round represents a month of work.\n      </p>\n      <h2>Rules</h2>\n      <p>\n        <em>\n          You can come back and review the rules at any point without losing\n          game progress\n        </em>\n      </p>\n      <ul>\n        <li>The game lasts 10 rounds.</li>\n        <li>Your team starts with a working capacity of 10 points.</li>\n        <ul>\n          <li>\n            These points can be spent on delivering Features to your customers\n            or possible Improvements (aka Actions). Each improvement you select\n            costs the team feature development capacity, just like real life.\n            And, also like in real life, these actions may or may not provide a\n            benefit in future rounds. We certainly hope they'll give us a\n            benefit, but not everything works out as planned.\n          </li>\n        </ul>\n        <li>\n          Improvements fall into three categories:\n          <ul>Engineering Practices - improve the quality of your code</ul>\n          <ul>\n            Communication Practices - improve the ability of team members to\n            work together\n          </ul>\n          <ul>\n            Product Ownership Practices - make it more likely that the team will\n            build the right product\n          </ul>\n        </li>\n        <li>\n          How you balance your investment in these improvements with the\n          delivery of features is entirely up to your team. Some improvement\n          practices have prerequisites.\n        </li>\n        <li>\n          Speaking of Features, just like real life, it is not certain the\n          features you deliver will be valuable to the customer. At the start of\n          the game, when you have little knowledge of the market and your target\n          customers, there's a strong possibility that what your team commits to\n          and delivers will actually delight the customer.\n        </li>\n        <li>\n          The game has gremlins -- that is, challenges that may crop up and\n          impact your team's ability to deliver. You may be able to avoid some\n          of these. But don't forget that your goal is the delivery of valuable\n          software that our customers will love.\n        </li>\n        <li>\n          And while your goal is to deliver features, the leaders of this\n          company have decided to give you a chance to get the team started on\n          the right foot. They've agreed to allow you to consider some possible\n          Improvements even before you've delivered one Story. But, they do\n          remind you that every improvement that you want to implement needs to\n          be done by the team, so will reduce their capacity to deliver\n          features.\n        </li>\n      </ul>\n      <h2>Rounds</h2>\n      <p>Each round consists of a series of steps:</p>\n      <ol>\n        <li>\n          You get a round description. Read the description as a team. &nbsp;\n          <b>Click Start Round</b>\n        </li>\n        <li>\n          Select Improvements or Actions that will affect the team.{' '}\n          <ul>\n            <li>\n              Once selected, the cost of the Action will be deducted from the\n              team's Capacity.\n            </li>\n            <li>\n              You can see your capacity reduce every time you select an Action\n              item.\n            </li>\n            <li>\n              Click <b>\"Begin Development\"</b>\n            </li>\n            <li>\n              And, you might get some feedback from the Senior Leaders of your\n              company, based on your choices.\n            </li>\n          </ul>\n        </li>\n        <li>\n          The game shows you how much capacity there is remaining to develop\n          your User Stories.\n        </li>\n        <li>\n          Click <b>Roll for User Stories</b>\n        </li>\n        <ul>\n          <li>\n            The game rolls a die for each User Story to determine how many are\n            actually completed. That's right. Not every Story will\n            necessarily get completed. Just like real life.\n          </li>\n          <li>\n            Have a look at how much work your team completed, and the impact\n            that's having. You may notice some feedback at the bottom, based on\n            your progress. It's worth considering any feedback you receive,\n            since it's coming from the people paying your salary.\n          </li>\n        </ul>\n        <li>\n          Click <b>Next Round</b>\n          <ul>\n            <li>\n              At the end of each round, the game also checks to see if your team\n              was affected by a Gremlin. Example: \"Manager yells at a team\n              member\"\n            </li>\n            <li>\n              As you progress through the rounds, you'll notice that your\n              Capacity increases or decreases depending on the improvements you\n              have made, or not, and the Gremlins that affect you.\n            </li>\n            <li>\n              After round 1, the game displays the active impacts of\n              Improvements that were previously made.\n            </li>\n            <li>\n              Actions not selected in a round are still available for the team\n              to adopt at a later time. To keep the User Interface tidy, they\n              can be found in the round where they were first available.\n            </li>\n          </ul>\n        </li>\n      </ol>\n      <p>\n        Hint: play the game as often as you want. So if you want to run\n        experiments to see what happens, go for it.\n      </p>\n      <h2>Limitations</h2>\n      <p>\n        If you play well you could improve your teams effectiveness by four to\n        five times. In reality, that would take more than the year implied in\n        the game. In addition, in reality many improvements would have an\n        ongoing cost that is longer than the game simulates.\n      </p>\n      <p>\n        Copyright:{' '}\n        <a href=\"https://agilepainrelief.com\">https://agilepainrelief.com</a>{' '}\n        2021\n      </p>\n    </>\n  );\n}\n","import React, { HTMLAttributes } from 'react';\nimport cx from 'classnames';\nimport styles from './Content.module.css';\n\nexport default function Content({\n  className,\n  ...rest\n}: HTMLAttributes<HTMLDivElement>) {\n  return <div className={cx(className, styles.content)} {...rest} />;\n}\n","import React, { HTMLAttributes } from 'react';\nimport cx from 'classnames';\nimport styles from './Container.module.css';\n\ntype Props = HTMLAttributes<HTMLDivElement> & {\n  review: boolean;\n  onClose: () => void;\n};\n\nexport default function Container({\n  className,\n  review,\n  children,\n  onClose,\n  ...rest\n}: Props) {\n  return (\n    <div className={cx(className, review && styles.review)} {...rest}>\n      {review && (\n        <div className={styles.reviewHint}>\n          Review <button onClick={onClose}>╳</button>\n        </div>\n      )}\n      {children}\n    </div>\n  );\n}\n","import React from 'react';\nimport type {\n  AppRound,\n  AppState,\n  GameActionAction,\n  GameConfig,\n} from '../../state';\nimport { findGameActionById } from '../../lib';\nimport { RoundDescription } from './Round';\nimport { ActionImage } from './Actions';\nimport styles from './Log.module.css';\nimport FinalResults from './FinalResults';\nimport { ActiveEffects } from './Status';\n\ntype RoundLogEntry = AppRound & {\n  storiesCompleted?: number;\n  actions: GameActionAction[];\n};\ntype Props = {\n  state: AppState;\n  config: GameConfig;\n  link: string;\n  totalRounds: number;\n};\nexport default function Log(props: Props) {\n  const rounds = [...props.state.pastRounds, props.state.currentRound];\n  const roundsLog: RoundLogEntry[] = [];\n  let currentRound: RoundLogEntry = { ...rounds[0], actions: [] };\n  roundsLog.push(currentRound);\n  props.state.log.forEach((action) => {\n    if (action.type === 'NEXT_ROUND') {\n      if (roundsLog.length < props.totalRounds) {\n        currentRound = { ...rounds[roundsLog.length], actions: [] };\n        roundsLog.push(currentRound);\n      }\n    } else {\n      currentRound.actions.push(action);\n    }\n  });\n\n  return (\n    <>\n      <h2>Game Log</h2>\n      <ol className={styles.roundList}>\n        {roundsLog.map((round) => {\n          return (\n            <li key={round.number}>\n              <h3>Round {round.number}</h3>\n              <ul>\n                <li>Total Capacity: {round.capacity.total}</li>\n                <li>User Stories Attempted: {round.capacity.available}</li>\n                <li>\n                  Chance of completing User Stories: {round.userStoryChance}\n                </li>\n                {round.storiesCompleted !== undefined && (\n                  <li>User Stories Completed: {round.storiesCompleted}</li>\n                )}\n              </ul>\n              <RoundDescription gremlin={round.gremlin}>\n                {round.description}\n              </RoundDescription>\n              {round.activeEffects.length ? (\n                <>\n                  <h4>Active Effects</h4>\n                  <ul>\n                    <ActiveEffects effects={round.activeEffects} showUnit />\n                  </ul>\n                </>\n              ) : null}\n              {round.actions.length ? (\n                <>\n                  <h4>Actions Taken</h4>\n                  <ul className={styles.actionList}>\n                    {round.actions.map((action, i) => {\n                      const gameAction = findGameActionById(\n                        action.payload,\n                        props.config.rounds,\n                      );\n                      const isReSelect = round.actions\n                        .slice(0, i)\n                        .map((action) => action.payload)\n                        .includes(action.payload);\n\n                      if (isReSelect) {\n                        return (\n                          <li key={i}>\n                            {action.type === 'UNSELECT_GAME_ACTION' && (\n                              <>\n                                Un-Selected: <del>{gameAction.name}</del>\n                              </>\n                            )}\n                            {action.type === 'SELECT_GAME_ACTION' && (\n                              <>\n                                Re-Selected: <ins>{gameAction.name}</ins>\n                              </>\n                            )}\n                          </li>\n                        );\n                      }\n\n                      return (\n                        <li key={i}>\n                          <ActionImage\n                            gameAction={gameAction}\n                            className={styles.actionImage}\n                          />\n                          <h5>\n                            Selected: (Cost: {gameAction.cost}){' '}\n                            {gameAction.name}\n                          </h5>\n                          {gameAction.description}\n                        </li>\n                      );\n                    })}\n                  </ul>\n                </>\n              ) : null}\n            </li>\n          );\n        })}\n      </ol>\n      <FinalResults state={props.state} link={props.link} />\n    </>\n  );\n}\n","import React, { ButtonHTMLAttributes, ReactNode } from 'react';\nimport cx from 'classnames';\nimport styles from './Tabs.module.css';\n\ntype Props = ButtonHTMLAttributes<HTMLButtonElement> & {\n  active?: boolean;\n};\n\nexport function Tabs(props: { children?: ReactNode }) {\n  return <div className={styles.tabs}>{props.children}</div>;\n}\n\nexport function Tab({ active, className, ...rest }: Props) {\n  return (\n    <button\n      className={cx(styles.tab, className, active && styles.tabActive)}\n      {...rest}\n    />\n  );\n}\n","import React, { HTMLAttributes } from 'react';\nimport cx from 'classnames';\nimport styles from './Rows.module.css';\n\nexport function Rows({ className, ...rest }: HTMLAttributes<HTMLDivElement>) {\n  return <div className={cx(className, styles.rows)} {...rest} />;\n}\n\nexport function Row({ className, ...rest }: HTMLAttributes<HTMLDivElement>) {\n  return <div className={cx(className, styles.row)} {...rest} />;\n}\n","import React, { useMemo, useState } from 'react';\nimport type { GameConfig } from '../state';\nimport {\n  Results,\n  FinalResults,\n  Actions,\n  Round,\n  Status,\n  Header,\n  Rules,\n  Tabs,\n  Tab,\n  Content,\n  Button,\n  Welcome,\n  Rows,\n  Container,\n  Row,\n  Log,\n} from './components';\nimport {\n  AppBaseState,\n  createInitialState,\n  GAME_STATE_OK,\n  InitialStateWithStatus,\n  restartGame,\n  useVersion,\n  saveToLocalStorage,\n  useAppState,\n} from '../lib';\n\ntype Props = { initialState: AppBaseState; config: GameConfig };\nexport function App(props: Props) {\n  const [state, closeRound, rollGremlin, link, dispatch] = useAppState(\n    props.config,\n    props.initialState,\n  );\n  const interactiveRounds = props.config.rounds.length;\n  const totalRounds = interactiveRounds + props.config.trailingRounds;\n\n  const [tab, setTab] = useState<'play' | 'rules' | 'log'>(\n    props.initialState.log.length === 0 ? 'rules' : 'play',\n  );\n\n  return (\n    <Container\n      review={state.ui.review !== false}\n      onClose={() => dispatch({ type: 'SET_UI_REVIEW_ACTION', payload: false })}\n    >\n      <Header>\n        <Tabs>\n          <Tab\n            active={false}\n            onClick={restartGame(dispatch)}\n            style={{ maxWidth: '2rem' }}\n            title=\"Restart Game\"\n          >\n            ↩\n          </Tab>\n          <Tab active={tab === 'play'} onClick={() => setTab('play')}>\n            Play\n          </Tab>\n          <Tab active={tab === 'log'} onClick={() => setTab('log')}>\n            Log\n          </Tab>\n          <Tab active={tab === 'rules'} onClick={() => setTab('rules')}>\n            Rules\n          </Tab>\n        </Tabs>\n      </Header>\n      <Content>\n        <div style={{ display: tab === 'play' ? 'block' : 'none' }}>\n          {state.ui.review === false &&\n          state.currentRound.number > totalRounds ? (\n            <FinalResults state={state} dispatch={dispatch} link={link} />\n          ) : (\n            <Round\n              ui={state.ui}\n              key={state.currentRound.number}\n              currentRound={state.currentRound}\n              totalRounds={totalRounds}\n              welcome={\n                <Welcome\n                  review={state.ui.review}\n                  dispatch={dispatch}\n                  totalRounds={totalRounds}\n                  gremlin={state.currentRound.gremlin}\n                >\n                  {state.currentRound.description}\n                </Welcome>\n              }\n              actions={\n                <>\n                  <Button\n                    onClick={() =>\n                      dispatch({\n                        type: 'SET_UI_VIEW_ACTION',\n                        payload: 'welcome',\n                      })\n                    }\n                  >\n                    ◀ Back\n                  </Button>\n                  <Button\n                    primary\n                    onClick={() =>\n                      dispatch({\n                        type: 'SET_UI_VIEW_ACTION',\n                        payload: 'results',\n                      })\n                    }\n                  >\n                    {state.ui.review === false\n                      ? 'Begin Development'\n                      : 'Show User Stories'}\n                  </Button>\n                  {state.currentRound.gremlin && (\n                    <p>\n                      ⚠️ Gremlin just happened:&nbsp;\n                      <strong>{state.currentRound.gremlin.name}</strong>\n                    </p>\n                  )}\n                  <Rows>\n                    <Row>\n                      <Actions\n                        ui={state.ui}\n                        rounds={props.config.rounds}\n                        currentRound={state.currentRound.number}\n                        availableCapacity={\n                          state.currentRound.capacity.available\n                        }\n                        availableGameActions={state.availableGameActions}\n                        dispatch={dispatch}\n                      />\n                    </Row>\n                    <Row>\n                      <Status\n                        {...state.currentRound}\n                        startCapacity={\n                          props.config.initialScores.capacityChange || 0\n                        }\n                      />\n                    </Row>\n                  </Rows>\n                </>\n              }\n              results={\n                <Results\n                  ui={state.ui}\n                  pastRounds={state.pastRounds}\n                  currentRound={state.currentRound}\n                  dispatch={dispatch}\n                  closeRound={closeRound}\n                  rollGremlin={rollGremlin}\n                  initialUserStoryChance={\n                    props.config.initialScores.userStoryChange || 0\n                  }\n                  totalRounds={totalRounds}\n                  interactiveRounds={interactiveRounds}\n                />\n              }\n            />\n          )}\n        </div>\n        {tab === 'rules' && <Rules />}\n        {tab === 'log' && (\n          <Log\n            state={state}\n            config={props.config}\n            totalRounds={totalRounds}\n            link={link}\n          />\n        )}\n      </Content>\n    </Container>\n  );\n}\n\nexport default function OutdatedStateWarning(props: {\n  initialState: InitialStateWithStatus;\n  config: GameConfig<any, any>;\n}) {\n  const version = useVersion();\n  const [initialState, setInitialState] = useState(props.initialState);\n  const configOverwrites = initialState.config;\n  const config = props.config;\n  const mergedConfig = useMemo(\n    () => ({\n      ...config,\n      ...configOverwrites,\n      initialScores: {\n        ...config.initialScores,\n        ...configOverwrites.initialScores,\n      },\n    }),\n    [config, configOverwrites],\n  );\n  if (!version) {\n    return null;\n  }\n\n  if (initialState.restored) {\n    return (\n      <>\n        <Header>\n          <br />\n        </Header>\n        <Content style={{ textAlign: 'center' }}>\n          <br />\n          <h2>Do you want to load the game encoded in the link?</h2>\n          <p>This will overwrite any currently running game</p>\n          {initialState.status !== GAME_STATE_OK ? (\n            <p>\n              ⚠️ The saved game to be restored might not work as expected\n              because the game has been updated since then\n            </p>\n          ) : null}\n          <Button\n            onClick={() => {\n              window.location.href = window.location.href.split('?')[0];\n            }}\n          >\n            Continue to my previous game\n          </Button>\n          <Button\n            onClick={() => {\n              saveToLocalStorage(\n                initialState.state,\n                version,\n                initialState.config,\n              );\n              window.location.href = window.location.href.split('?')[0];\n            }}\n            primary\n          >\n            Restore Game from {initialState.restored.toLocaleString()}\n          </Button>\n        </Content>\n      </>\n    );\n  }\n\n  if (initialState.status === GAME_STATE_OK) {\n    return <App initialState={initialState.state} config={mergedConfig} />;\n  }\n\n  return (\n    <>\n      <Header>\n        <br />\n      </Header>\n      <Content style={{ textAlign: 'center' }}>\n        <br />\n        <h2>The game has been updated.</h2>\n        <h4>Your currently saved game might not work as expected</h4>\n        <Button\n          onClick={() =>\n            setInitialState({\n              state: initialState.state,\n              config: props.initialState.config,\n              status: GAME_STATE_OK,\n            })\n          }\n        >\n          Continue anyways\n        </Button>\n        <Button\n          onClick={() =>\n            setInitialState({\n              state: createInitialState(),\n              config: props.initialState.config,\n              status: GAME_STATE_OK,\n            })\n          }\n          primary\n        >\n          Restart Game\n        </Button>\n      </Content>\n    </>\n  );\n}\n","import React from 'react';\nimport type { RoundDescription } from './index';\n\nexport type Round1ActionId =\n  | 'PROTECTED_FROM_OUTSIDE_DISTRACTION'\n  | 'CLARIFY_PRODUCT_VISION'\n  | 'WORKING_AGREEMENTS'\n  | 'BUILD_SERVER'\n  | 'TEAMS_ON_SAME_FLOOR';\n\nexport const round1: RoundDescription<Round1ActionId> = {\n  title: 'Team, welcome to the World’s Smallest Online Bookstore',\n  description: (\n    <p>\n      We hired you because you’re the best individuals in your respective areas.\n      Please remember that we’re Vulture Capital funded and we have only a few\n      months runway, so you must deliver. This first Sprint, the company really\n      needs you to prove that you can deliver a working Bookstore soon.\n    </p>\n  ),\n  actions: {\n    PROTECTED_FROM_OUTSIDE_DISTRACTION: {\n      image: 'https://placekitten.com/100/100',\n      name: 'Protected from Outside Distraction',\n      description: (\n        <>\n          <p>\n            ScrumMaster protects the team from outside distraction. Example: a\n            manager asking a team member to do them a small favour as it will\n            only take an hour.\n          </p>\n          <p>\n            For a deeper understanding see:{' '}\n            <a href=\"https://agilepainrelief.com/blog/scrum-master-tales-more-interruptions.html\">\n              Scrum By Example – Interruptions Hurt the Team\n            </a>{' '}\n            and Agile Glossary and Reference Library:{' '}\n            <a href=\"https://agilepainrelief.com/glossary/interruptions\">\n              Interruptions\n            </a>\n          </p>\n        </>\n      ),\n      cost: 1,\n      effect: () => ({ userStoryChange: 10 }),\n    },\n    CLARIFY_PRODUCT_VISION: {\n      image: 'https://placekitten.com/100/100',\n      name: 'Clarify Product Vision',\n      description: (\n        <>\n          <p>\n            Product Owner and Development Team collaborate on understanding\n            Product Vision using an exercise like Product Box. Teams that aren’t\n            involved in the creation of their product vision are doomed to build\n            Product that neither Product Owner, Customers, nor Stakeholders\n            want.\n          </p>\n          <p>\n            For a deeper understanding see Agile Glossary and Reference Library:{' '}\n            <a href=\"https://agilepainrelief.com/glossary/vision\">Vision</a>\n          </p>\n        </>\n      ),\n      cost: 2,\n      effect: () => ({ userStoryChange: 10 }),\n    },\n\n    WORKING_AGREEMENTS: {\n      image: '/images/example.jpg',\n      type: 'COMMUNICATION',\n      name: 'Working Agreements',\n      description: (\n        <>\n          <p>\n            Working Agreements are a simple, powerful way of creating explicit\n            guidelines for what kind of work culture you want for your Team.\n            They are a reminder for everyone about how they can commit to\n            respectful behaviour and communication.\n          </p>\n          <p>\n            For a deeper understanding see\n            <a href=\"https://agilepainrelief.com/blog/team-friction-inspires-working-agreements.html\">\n              Scrum by Example – Team Friction Inspires Working Agreements\n            </a>{' '}\n            Agile Glossary and Reference Library:{' '}\n            <a href=\"https://agilepainrelief.com/glossary/working-agreements\">\n              Working Agreement\n            </a>\n          </p>\n        </>\n      ),\n      cost: 1,\n      effect: () => ({ capacityChange: 1 }),\n    },\n    BUILD_SERVER: {\n      image: '/images/example.jpg',\n      type: 'ENGINEERING',\n      name: 'Build Server',\n      description: (\n        <>\n          <p>\n            Setup Build Server and Continuous Integration. This is required to\n            make future engineering improvements.\n          </p>\n          <p>\n            For a deeper understanding see Agile Glossary and Reference Library:{' '}\n            <a href=\"https://agilepainrelief.com/glossary/continuous-integration\">\n              Continuous Integration\n            </a>\n          </p>\n        </>\n      ),\n      cost: 2,\n    },\n    TEAMS_ON_SAME_FLOOR: {\n      image: '/images/example.jpg',\n      name: 'Team Members on Same Floor',\n      type: 'COMMUNICATION',\n      description:\n        \"Getting Team Members on the same floor reduces the cost of communication as they don't have to go far to ask questions.\",\n      cost: 3,\n      /* don't use arrow function in order to have \"this\" bound to action */\n      effect(age) {\n        if (age < 6) {\n          return {\n            capacityChange: age,\n            title: `${this.name} active since ${age + 1} rounds`,\n          };\n        }\n\n        return {\n          capacityChange: 5,\n          title: `${this.name} active since 5 or more rounds`,\n        };\n      },\n    },\n  },\n};\n","import React from 'react';\nimport type { RoundDescription } from './index';\n\nexport type Round2ActionId =\n  | 'REMOTE_TEAM_AVATARS'\n  | 'ELIMINATE_LONG_LIVED_FEATURE_BRANCHES'\n  | 'UNIT_TESTING'\n  | 'SOCIAL_TIME'\n  | 'PROBLEM_SOLVING_BONUS'\n  | 'BACKLOG_REFINEMENT';\n\nexport const BR_USER_STORY_CHANGE = 15;\n\nexport const round2: RoundDescription<Round2ActionId> = {\n  title: 'Failed Expectations',\n  description: (\n    <p>\n      Your team didn't meet our expectations that you would complete 10 User\n      Stories in the last round. Our vulture capitalists are becoming concerned\n      and ask if you can really deliver? They have decided we need more problem\n      solvers on the team.\n    </p>\n  ),\n  actions: {\n    REMOTE_TEAM_AVATARS: {\n      icon: '👋',\n      name: 'Remote Team Avatars',\n      description: (\n        <p>\n          Remote Teams suffer from the start, in that team members don't get to\n          know about their colleagues easily. To counter this, run a short get\n          to know you session. Get team members to share things like: working\n          hours, city they live in, time zone, contact info. If people are open,\n          share some personal details such as hobbies, family status, favorite\n          food and beverage. Some teams even create a wiki or site to share this\n          information.\n        </p>\n      ),\n      cost: 1,\n      effect: () => ({ capacityChange: 1 }),\n    },\n    ELIMINATE_LONG_LIVED_FEATURE_BRANCHES: {\n      image: '/images/example.jpg',\n      type: 'ENGINEERING',\n      name: 'All Work is Done on Main or Trunk',\n      description: (\n        <>\n          <p>\n            When teams use Feature Branches – then they’re not really using\n            Continuous Integration. Feature branching optimizes for the\n            individual while harming the Team.\n          </p>\n          <p>\n            For a deeper understanding see Agile Glossary and Reference Library:{' '}\n            <a href=\"https://agilepainrelief.com/glossary/branching-strategies\">\n              Branching Strategies in Source Control\n            </a>\n          </p>\n        </>\n      ),\n      cost: 2,\n      effect: () => ({ capacityChange: 1 }),\n    },\n    UNIT_TESTING: {\n      icon: '🏗',\n      type: 'ENGINEERING',\n      name: 'Unit Testing',\n      available: { requires: 'BUILD_SERVER' },\n      description: (\n        <>\n          <p>\n            Unit Testing is the approach of testing the smallest possible\n            fragment of code. It ensures that the code does what the developer\n            expected it do.\n          </p>\n          <p>\n            For a deeper understanding see Agile Glossary and Reference Library:{' '}\n            <a href=\"https://agilepainrelief.com/glossary/unit-testing\">\n              Unit Testing\n            </a>\n          </p>\n        </>\n      ),\n      cost: 2,\n      effect: () => ({ capacityChange: 1 }),\n    },\n    SOCIAL_TIME: {\n      image: '/images/example.jpg',\n      type: 'COMMUNICATION',\n      name: 'Social Time',\n      description: (\n        <p>\n          Setting aside some time during the working day to talk to your peers\n          outside of the work itself.\n        </p>\n      ),\n      cost: 1,\n      effect: () => ({\n        capacityChange: 1,\n        title:\n          'This benefits the team, as team members get to know each other not just as doers of work.',\n      }),\n    },\n    PROBLEM_SOLVING_BONUS: {\n      image: '/images/example.jpg',\n      name: 'Problem Solving Award',\n      description: (\n        <p>\n          Offer a bonus to the team member who solves our current site\n          performance problem.\n        </p>\n      ),\n      cost: 0,\n      effect(age) {\n        // First round it has a positive affect, the second round eliminates it. No effect after that.\n        let change = 0;\n        if (age === 1) {\n          change = 1;\n        } else if (age > 1) {\n          change = -1;\n        }\n\n        return {\n          capacityChange: change,\n          title: `${this.name} active since ${age} rounds`,\n        };\n      },\n    },\n    BACKLOG_REFINEMENT: {\n      image: '/images/example.jpg',\n      type: 'COMMUNICATION',\n      name: 'Backlog Refinement',\n      description: (\n        <>\n          <p>\n            The Development Team and the Product Owner sit down every Sprint.\n            They take the time to better understand upcoming features. They\n            might estimate or split stories, create acceptance criteria. They\n            also create new stories and delete ones that no longer make sense.\n            All of this improves their understanding of the product they're\n            building.\n          </p>\n          <p>\n            For a deeper understanding see:{' '}\n            <a href=\"https://agilepainrelief.com/blog/scrum-product-backlog-refinement.html\">\n              Scrum by Example – Product Backlog Refinement in Action\n            </a>\n          </p>\n        </>\n      ),\n      cost: 3,\n      effect: () => ({ userStoryChange: BR_USER_STORY_CHANGE }),\n    },\n  },\n};\n","import React from 'react';\nimport type { RoundDescription } from './index';\n\nexport type Round3ActionId =\n  | 'IMPROVE_RETROSPECTIVES_CHANGE_AGENDA'\n  | 'OBSERVE_PEOPLE_AND_RELATIONSHIPS'\n  | 'ONE_ON_ONES'\n  | 'PAIR_PROGRAMMING'\n  | 'STORY_MAPPING_OR_OTHER'\n  | 'REFACTORING';\n\nexport const round3: RoundDescription<Round3ActionId> = {\n  title: 'Work Harder',\n  description: (\n    <p>\n      Things are slowly improving. You are getting better. *Please* work harder\n      in the next Sprint.\n    </p>\n  ),\n  effect: () => ({ title: false, gremlinChange: 50 }),\n  actions: {\n    IMPROVE_RETROSPECTIVES_CHANGE_AGENDA: {\n      image: '/images/example.jpg',\n      type: 'COMMUNICATION',\n      name: 'Change Retrospective Style',\n      description: (\n        <>\n          <p>\n            ScrumMaster changes the Retrospective Agenda and activies every\n            Sprint\n          </p>\n          <p>\n            For a deeper understanding see:{' '}\n            <a href=\"https://agilepainrelief.com/blog/agile-retrospectives.html\">\n              Agile Retrospectives\n            </a>\n          </p>\n        </>\n      ),\n      cost: 1,\n      effect(age) {\n        let description =\n          'Changing Retrospective Agendas reengergizes them and tends to find different problems each title';\n        if (age === 0) {\n          return {\n            title: description,\n            capacityChange: 0,\n          };\n        }\n        if (age < 2) {\n          return {\n            title: description,\n            capacityChange: 1,\n          };\n        }\n        if (age === 2 || age === 3) {\n          return {\n            title: description,\n            capacityChange: 2,\n          };\n        }\n        return {\n          title: description,\n          capacityChange: 3,\n        };\n      },\n    },\n    OBSERVE_PEOPLE_AND_RELATIONSHIPS: {\n      image: '/images/example.jpg',\n      type: 'COMMUNICATION',\n      name: 'Observe People + Relationships',\n      description: (\n        <p>\n          ScrumMaster spends time observing people, how they interact, and the\n          quality of their relationship.\n        </p>\n      ),\n      cost: 1,\n      effect: () => ({\n        capacityChange: 1,\n        title: 'Watching the Team tells you where to put your coaching energy.',\n      }),\n    },\n    ONE_ON_ONES: {\n      image: '/images/example.jpg',\n      type: 'COMMUNICATION',\n      name: 'One on One',\n      description: (\n        <p>\n          ScrumMaster meets with all team members for a regular one-on-one. Once\n          ‘Gremlins’ start to popup, this action mitigates the worst of the\n          effects, because you already have a deeper understanding of team\n          member needs.\n        </p>\n      ),\n      cost: 1,\n    },\n    PAIR_PROGRAMMING: {\n      image: '/images/example.jpg',\n      type: 'ENGINEERING',\n      name: 'Pair Programming',\n      description: <p>Two team members – one computer</p>,\n      cost: 2,\n      effect: () => ({\n        capacityChange: 1,\n        title:\n          'Team Members working in pairs have a lower defect rate, simpler code and learn from each other.',\n      }),\n    },\n    STORY_MAPPING_OR_OTHER: {\n      image: '/images/example.jpg',\n      type: 'COMMUNICATION',\n      name: 'Story Mapping',\n      available: { requires: 'CLARIFY_PRODUCT_VISION' },\n      description: (\n        <>\n          <p>\n            Story Mapping is a strategic tool that gets Developers and the\n            Product Owner to discuss strategy. Story mapping helps link\n            understanding of Product Vision with the individual User Stories.\n          </p>\n          <p>\n            For a deeper understanding see Agile Glossary and Reference Library:{' '}\n            <a href=\"https://agilepainrelief.com/glossary/story-mapping\">\n              Story Mapping\n            </a>\n            <a href=\"https://agilepainrelief.com/glossary/roadmaps-and-strategy\">\n              Roadmaps and Strategy\n            </a>\n          </p>\n        </>\n      ),\n      cost: 2,\n      effect: () => ({ userStoryChange: 10 }),\n    },\n    REFACTORING: {\n      image: '/images/example.jpg',\n      type: 'ENGINEERING',\n      name: 'Refactoring',\n      available: { requires: 'BUILD_SERVER' },\n      description: (\n        <p>\n          Refactoring is the process of restructuring existing code without\n          changing its external behavior. It is intended to improve the design\n          and structure, while preserving its functionality. As a side effect,\n          it can reduces the volume of code and its complexity.\n        </p>\n      ),\n      cost: 1,\n      effect: () => ({\n        capacityChange: 1,\n        title:\n          'Refactoring leaves us with simplier code, allowing the team to work faster',\n      }),\n    },\n  },\n};\n","import React from 'react';\nimport type { RoundDescription } from './index';\n\nexport type Round4ActionId =\n  | 'CROSS_SKILLING'\n  | 'EXTERNAL_CROSS_TRAINING'\n  | 'PERSONAL_PRODUCTIVITY_BONUS'\n  | 'NEW_TESTER'\n  | 'TEST_DRIVEN_DEVELOPMENT'\n  | 'LIMIT_WIP';\n\nexport const round4: RoundDescription<Round4ActionId> = {\n  title: 'Team is Bottlenecked',\n  description: (\n    <p>\n      The team is suffering, their work is queueing up in front the tester.\n      Imploring them to work faster is failing.\n    </p>\n  ),\n  actions: {\n    CROSS_SKILLING: {\n      image: '/images/example.jpg',\n      name: 'Informal Cross-Skilling',\n      description: (\n        <>\n          <p>\n            Informal cross-skilling for existing team members in an area the\n            team is weak. This is often achieved through Pair Programming,\n            Learning Time, etc (Testing anyone?)\n          </p>\n          <p>\n            For a deeper understanding see:{' '}\n            <a href=\"https://agilepainrelief.com/blog/how-to-cross-skill-and-grow-t-shaped-team-members.html\">\n              How to Cross-Skill and Grow T-shaped Team Members\n            </a>\n          </p>\n        </>\n      ),\n      cost: 4,\n      effect(age) {\n        let change = age - 1;\n        if (age > 4) {\n          change = 3;\n        }\n        return {\n          capacityChange: change,\n        };\n      },\n    },\n    EXTERNAL_CROSS_TRAINING: {\n      image: '/images/example.jpg',\n      name: 'Send Team Members on a Testing Course',\n      description: (\n        <p>\n          Take an outside course to improve the skills of one existing team\n          members in an area the team is weak. (Testing anyone?)\n        </p>\n      ),\n      cost: 3,\n      effect(age) {\n        let change = 0;\n        if (age > 2) {\n          change = 2;\n        }\n\n        return {\n          capacityChange: change,\n        };\n      },\n    },\n    NEW_TESTER: {\n      image: '/images/example.jpg',\n      name: 'Hiring a new Tester',\n      description: (\n        <p>\n          Hire a new Tester for the team. This person will reduce the load on\n          your existing tester and speed things up eventually.'\n        </p>\n      ),\n      cost: 2,\n      effect(age) {\n        if (age <= 2) {\n          return {\n            title:\n              'Hiring a new person and bringing them up to speed slows the team down and damages existing Team member relationships',\n            capacityChange: -age,\n          };\n        }\n        if (age === 3) {\n          return {\n            title: 'Eventually the new person starts fit in',\n            capacityChange: -1,\n          };\n        }\n        let resultDesc = 'Finally the new person helps';\n        if (age === 4) {\n          return {\n            title: resultDesc,\n            capacityChange: 1,\n          };\n        }\n        return {\n          title: resultDesc,\n          capacityChange: 2,\n        };\n      },\n    },\n    LIMIT_WIP: {\n      image: '/images/example.jpg',\n      name: 'Limit Work In Progress',\n      description: (\n        <p>\n          Too many teams start their Sprint with each team member grabbing their\n          own User Story Card. So with a team of 6 people there are now 6 items\n          in progress. The challenge is that no one team member can complete\n          their work independantly from the others. As result there will be work\n          that was started at the beginning of the Sprint, that is incomplete at\n          the end. The more work in progress, the less work gets done. Kanban\n          has a saying for this: \"Stop Starting and Start Finishing\". In\n          practice this means Limiting Work in Progress.\n        </p>\n      ),\n      cost: 2,\n      effect(age) {\n        let change = age - 1;\n        if (age > 4) {\n          change = 3;\n        }\n        return {\n          capacityChange: change,\n        };\n      },\n    },\n    TEST_DRIVEN_DEVELOPMENT: {\n      image: '/images/example.jpg',\n      type: 'ENGINEERING',\n      name: 'Test Driven Development',\n      available: { requires: 'REFACTORING' },\n      description: (\n        <p>\n          Writing Unit-level Tests before writing the code. TDD helps the\n          quality by ensuring the developer understands what they're attempting\n          to build before they build it. As a side effect, it reduces the volume\n          of code and its complexity, thereby reducing the number of defects.\n          This skill takes time to learn.\n        </p>\n      ),\n      cost: 3,\n      effect(age) {\n        let change = age - 1;\n        if (age > 4) {\n          change = 3;\n        }\n\n        return {\n          capacityChange: change,\n        };\n      },\n    },\n    PERSONAL_PRODUCTIVITY_BONUS: {\n      image: '/images/example.jpg',\n      name: 'Personal Productivity Bonus',\n      description: (\n        <p>\n          The company will offer anyone who exceeds their performance goals an\n          extra $5,000. A manager says team members working harder will increase\n          the likelihood of completing features on time\n        </p>\n      ),\n      cost: 2,\n      effect(age) {\n        if (age === 0) {\n          return [\n            {\n              userStoryChange: 50,\n              title:\n                'Productivity Bonus helped in the short term - team members focused on individual productivity',\n            },\n          ];\n        }\n        if (age >= 2) {\n          return [\n            {\n              capacityChange: -1,\n              title:\n                'Productivity Bonus helped in the short term and then the benefit waned. Along the way it harmed collaboration',\n            },\n          ];\n        }\n        return null;\n      },\n    },\n  },\n};\n","import React from 'react';\nimport type { RoundDescription } from './index';\n\nexport type Round5ActionId =\n  | 'BYPASS_DEFINITION_OF_DONE'\n  | 'INCLUDE_STAKEHOLDERS_IN_VISION_UPDATE'\n  | 'ADOPT_BDD'\n  | 'WORK_WITH_PO_LIMIT_PB_SIZE'\n  | 'ESTABLISH_SPRINT_GOALS'\n  | 'MAKE_IMPEDIMENTS_LIST_PUBLIC';\n\nexport const round5: RoundDescription<Round5ActionId> = {\n  title: 'Nearly There',\n  description: (\n    <p>\n      We're so close to the end. Be aware our stakeholders are unhappy, they\n      don't see you working hard enough. Please cut corners, we need to be ready\n      for launch.\n    </p>\n  ),\n  actions: {\n    BYPASS_DEFINITION_OF_DONE: {\n      image: '/images/example.jpg',\n      name: 'Bypass the Definition of Done',\n      description: (\n        <p>\n          Skipping elements in the Definition of Done will allow us to go\n          faster.\n        </p>\n      ),\n      cost: 0,\n      effect(age) {\n        if (age === 1) {\n          return { capacityChange: 2 };\n        }\n        return {\n          capacityChange: 0,\n          userStoryChange: -10,\n        };\n      },\n    },\n    INCLUDE_STAKEHOLDERS_IN_VISION_UPDATE: {\n      image: '/images/example.jpg',\n      name: 'Include Stakeholders in updating Vision',\n      description: (\n        <p>\n          When we include our stakeholders (end users and customers etc) in\n          building our Product Vision and Strategy it makes it more likely, that\n          our product will meet their needs.\n        </p>\n      ),\n      cost: 1,\n      effect(age) {\n        if (age < 1) {\n          return {\n            userStoryChange: 0,\n            title: \"Include Stakeholders in updating Vision hasn't helped yet\",\n          };\n        }\n        return {\n          userStoryChange: 10,\n          title:\n            'Include Stakeholders in updating Vision after a delay this eventually helped ',\n        };\n      },\n    },\n    ADOPT_BDD: {\n      image: '/images/example.jpg',\n      name: 'Adopt Behaviour Driven Development',\n      description: (\n        <>\n          <p>\n            Team members collaborate before starting work on developing a User\n            Story team members review and establish basic acceptance criteria.\n            As they grow in skill, they often write the acceptance criteria as\n            automated acceptance tests in a language that can be read by all\n            members of the team.\n          </p>\n          <p>\n            For more see:{' '}\n            <a href=\"https://agilepainrelief.com/blog/scrummaster-tales-team-collaborate-acceptance-criteria.html\">\n              Scrum By Example - The Team Collaborate on Acceptance Criteria\n            </a>\n          </p>\n        </>\n      ),\n      cost: 2,\n      effect(age) {\n        if (age <= 2) {\n          return {\n            title:\n              'Improving Collaboration slows the team at first. Even from the start it improves quality and completition of User Stories',\n            capacityChange: -1,\n            userStoryChange: 10,\n          };\n        }\n        if (age === 3 || age === 4) {\n          return {\n            capacityChange: 0,\n            userStoryChange: 15,\n          };\n        }\n        return {\n          capacityChange: 1,\n          userStoryChange: 20,\n        };\n      },\n    },\n    WORK_WITH_PO_LIMIT_PB_SIZE: {\n      image: '/images/example.jpg',\n      name: 'Limit the Size of the Product Backlog',\n      description: (\n        <>\n          <p>\n            The ScrumMaster works with the Product Owner to make sure the\n            ProductBacklog remains a manageable size. My recommendation max 3\n            months work. Items that are further away are still visible in the\n            Story Map but haven't be broken done into smaller parts. They also\n            work to ensure the Product Backlog is prioritized and up to date.\n          </p>\n          <p>\n            This helps the Product Owner because it will be easier to keep track\n            of important items. It helps the team because they will wasted less\n            time in Product Backlog Refinement. Last it helps the stakeholders\n            because we're able to give them honest forecasts.\n          </p>\n        </>\n      ),\n      cost: 1,\n      effect(age) {\n        if (age < 2) {\n          return { capacityChange: 0 };\n        }\n        return {\n          capacityChange: 1,\n        };\n      },\n    },\n    ESTABLISH_SPRINT_GOALS: {\n      image: '/images/example.jpg',\n      name: 'Establish Sprint Goals',\n      available: { requires: 'BACKLOG_REFINEMENT' },\n      description: (\n        <>\n          <p>\n            Sprint Goals help the team by giving them focus in the Sprint, by\n            helping the team better understand what they're trying to achieve.\n            If the team is having trouble in Sprint the Goal is a refocusing\n            tool.\n          </p>\n          <p>\n            For more see:{' '}\n            <a href=\"https://agilepainrelief.com/blog/sprint-goals-provide-purpose.html\">\n              Sprint Goals Provide Purpose\n            </a>\n          </p>\n        </>\n      ),\n      cost: 1,\n      effect(age) {\n        if (age <= 1) {\n          return {\n            userStoryChange: 5,\n          };\n        }\n        if (age <= 3) {\n          return {\n            userStoryChange: 10,\n          };\n        }\n        return {\n          userStoryChange: 15,\n        };\n      },\n    },\n    MAKE_IMPEDIMENTS_LIST_PUBLIC: {\n      image: '/images/example.jpg',\n      name: 'Post a List of the Teams Impediments',\n      type: 'COMMUNICATION',\n      description: (\n        <>\n          <p>\n            All teams have impediments and slow downs. Good teams make them\n            visible. Great teams eliminate them. In Scrum we expect the\n            ScrumMaster to maintain a public list of these impediments and then\n            work to resolve them.\n          </p>\n        </>\n      ),\n      cost: 1,\n      effect(age) {\n        let change = age - 1;\n        if (age > 4) {\n          change = 3;\n        }\n        return {\n          capacityChange: change,\n        };\n      },\n    },\n  },\n};\n","import type { RoundDescription as Rd } from '../../state';\nimport type { GremlinId } from '../gremlins';\n\nimport { round1, Round1ActionId } from './round1';\nimport { round2, Round2ActionId } from './round2';\nimport { round3, Round3ActionId } from './round3';\nimport { round4, Round4ActionId } from './round4';\nimport { round5, Round5ActionId } from './round5';\nimport { round6, Round6ActionId } from './round6';\nimport { round7, Round7ActionId } from './round7';\nimport { round8 } from './round8';\n\nexport type GameActionId =\n  | Round1ActionId\n  | Round2ActionId\n  | Round3ActionId\n  | Round4ActionId\n  | Round5ActionId\n  | Round6ActionId\n  | Round7ActionId;\n\nexport type RoundDescription<RoundActionId extends string> = Rd<\n  RoundActionId,\n  GameActionId,\n  GremlinId\n>;\n\nexport const rounds = [\n  round1,\n  round2,\n  round3,\n  round4,\n  round5,\n  round6,\n  round7,\n  round8,\n];\n","import React from 'react';\nimport type { RoundDescription } from './index';\n\nexport type Round6ActionId =\n  | 'IMPROVE_FORECASTING'\n  | 'IMPROVE_RETROSPECTIVES_CONCRETE_ACTIONS'\n  | 'LEARNING_TIME'\n  | 'SPRINT_BACKLOG_IMPROVEMENT'\n  | 'DAILY_SCRUM_MORE_EFFECTIVE';\n\nexport const overtimeUserStoryChance = -20;\nexport const overtimeCapacityBump = 4;\n\nexport const round6: RoundDescription<Round6ActionId> = {\n  title: 'Go Live Soon',\n  description: (\n    <p>\n      We must go live with an early version of the product at the end of this\n      round. Due to your limited productivity in past rounds, management are\n      prepared to offer some options to help you out. We will provide an extra\n      ‘4’ points of capacity for anything that helps. Overtime? Don\\'t worry a\n      little overtime won't hurt.\n    </p>\n  ),\n  effect: (_, currentRound) => {\n    if (currentRound === 6) {\n      return {\n        capacityChange: overtimeCapacityBump,\n        title: 'Management is paying overtime',\n      };\n    }\n    if (currentRound === 7 || currentRound === 8) {\n      return {\n        userStoryChange: overtimeUserStoryChance,\n        title: 'Overtime harmed focus and qualityq',\n      };\n    }\n    return null;\n  },\n  actions: {\n    IMPROVE_FORECASTING: {\n      image: '/images/example.jpg',\n      name: 'Improve Forecasting',\n      description: (\n        <p>Switch from a simple velocity model to probablistic forecasts.</p>\n      ),\n      cost: 1,\n    },\n    IMPROVE_RETROSPECTIVES_CONCRETE_ACTIONS: {\n      image: '/images/example.jpg',\n      name: 'Make Retrospective Action Items Concrete',\n      type: 'COMMUNICATION',\n      description: (\n        <>\n          <p>Team make Retrospective Action Items Concrete and Actionable</p>\n          <p>\n            For examples and depth see:{' '}\n            <a href=\"https://agilepainrelief.com/guide-to-effective-agile-retrospectives\">\n              The Guide to Effective Agile Retrospectives\n            </a>\n          </p>\n        </>\n      ),\n      cost: 1,\n      effect(age) {\n        if (age < 2) {\n          return { capacityChange: 0 };\n        }\n        if (age === 2) {\n          return { capacityChange: 1 };\n        }\n        return { capacityChange: 2 };\n      },\n    },\n    LEARNING_TIME: {\n      image: '/images/example.jpg',\n      name: 'Learning time',\n      description: (\n        <>\n          <p>\n            Take a few hours every Sprint and use that time to learn or practice\n            a new skill as a team.\n          </p>\n          <p>\n            For a deeper understanding see:{' '}\n            <a href=\"https://agilepainrelief.com/blog/scrummaster-tales-the-team-learn-how-to-learn.html\">\n              Scrum By Example – The Team Learn How to Learn\n            </a>\n          </p>\n        </>\n      ),\n      cost: 2,\n      effect(age) {\n        let description =\n          'Setting aside time to learn and practice speeds all kinds of skill acquistion and improvement';\n        if (age === 0) {\n          return {\n            title: description,\n            capacityChange: 0,\n          };\n        }\n        if (age < 2) {\n          return {\n            title: description,\n            capacityChange: 1,\n          };\n        }\n        if (age === 2 || age === 3) {\n          return {\n            title: description,\n            capacityChange: 2,\n          };\n        }\n        return {\n          title: description,\n          capacityChange: 3,\n        };\n      },\n    },\n    SPRINT_BACKLOG_IMPROVEMENT: {\n      image: '/images/example.jpg',\n      name: 'Improve Sprint Backlog',\n      type: 'COMMUNICATION',\n      description: <p>Team takes ownership of their Sprint Backlog</p>,\n      cost: 1,\n      effect(age) {\n        if (age < 2) {\n          return { capacityChange: 0, userStoryChange: 0 };\n        }\n        return {\n          capacityChange: 1,\n          userStoryChange: 5,\n        };\n      },\n    },\n    DAILY_SCRUM_MORE_EFFECTIVE: {\n      image: '/images/example.jpg',\n      name: 'Make Daily Scrum more Effective',\n      type: 'COMMUNICATION',\n      description: (\n        <>\n          <p>Refocus Daily Scrum on the Sprint Goal</p>\n          <p>\n            For a deeper understanding see:{' '}\n            <a href=\"https://agilepainrelief.com/blog/daily-scrum-pain.html\">\n              Scrum by Example – Feeling Pain from Your Daily Scrum?\n            </a>\n          </p>\n        </>\n      ),\n      cost: 1,\n      effect(age) {\n        if (age < 2) {\n          return { capacityChange: 0, userStoryChange: 0 };\n        }\n        if (age === 2) {\n          return { capacityChange: 1, userStoryChange: 5 };\n        }\n        return {\n          capacityChange: 2,\n          userStoryChange: 10,\n        };\n      },\n    },\n  },\n};\n","import React from 'react';\nimport type { RoundDescription } from './index';\n\nexport type Round7ActionId =\n  | 'PREALLOCATE_CAPACITY_FOR_PRODUCTION_SUPPORT'\n  | 'ONE_PERSON_DEALS_WITH_DEFECTS';\n\nexport const round7: RoundDescription<Round7ActionId> = {\n  title: \"We're Live and We Have Real Customers\",\n  description: (\n    <p>\n      Congratulations, our product is live in the market. People are using it\n      and they're finding bugs. We will have to go deal with those bugs this\n      Sprint.\n    </p>\n  ),\n  actions: {\n    ONE_PERSON_DEALS_WITH_DEFECTS: {\n      image: '/images/example.jpg',\n      name: 'One Person Deals with Defects',\n      description: (\n        <>\n          <p>\n            In Sprint Planning one person volunteers to run point for production\n            support issues\n          </p>\n          <p>\n            For examples and depth see:{' '}\n            <a href=\"https://agilepainrelief.com/blog/scrum-production-support.html\">\n              Scrum by Example – How to Handle Production Support Issues in\n              Scrum\n            </a>\n          </p>\n        </>\n      ),\n      cost: 3,\n    },\n    PREALLOCATE_CAPACITY_FOR_PRODUCTION_SUPPORT: {\n      image: '/images/example.jpg',\n      name: 'Allocate Capacity for bugs',\n      description: (\n        <>\n          <p>\n            In Sprint Planning allocate up to 20% of the teams time to deal with\n            production support issues\n          </p>\n          <p>\n            For examples and depth see:{' '}\n            <a href=\"https://agilepainrelief.com/blog/scrum-production-support.html\">\n              Scrum by Example – How to Handle Production Support Issues in\n              Scrum\n            </a>\n          </p>\n        </>\n      ),\n      cost: 3,\n    },\n  },\n};\n","import React from 'react';\nimport type { RoundDescription } from './index';\n\nexport const round8: RoundDescription<never> = {\n  title: 'TODO: ADD TITLE',\n  description: <p>{/* TODO: ADD DESCRIPTION */}</p>,\n  actions: {},\n};\n","import React from 'react';\nimport type { GameActionId } from '../rounds';\nimport type { GremlinList } from '../../state';\nimport { selectedActionIds } from '../../lib';\n\nexport type GremlinId =\n  | 'GREMLIN_MANAGEMENT_YELLS'\n  | 'GREMLIN_EMERGENCY_ON_OTHER_TEAM'\n  | 'GREMLIN_NOT_PULLING_THEIR_WEIGHT'\n  | 'GREMLIN_NOT_AT_DAILY_SCRUM'\n  | 'GREMLIN_NEW_STORY_MID_SPRINT'\n  | 'GREMLIN_UNREADABLE_CODE'\n  | 'GREMLIN_POOR_QUALITY'\n  | 'GREMLIN_PRODUCT_BACKLOG_MESS'\n  | 'GREMLIN_SKIP_RETRO';\n\nexport const gremlins: GremlinList<GremlinId, GameActionId> = {\n  GREMLIN_MANAGEMENT_YELLS: {\n    name: 'Management yells at a team member in public',\n    probability: () => 10,\n    description: (\n      <p>\n        Management yells at a team member in public for not pulling their\n        weight. The team member who was yelled at feels their personal status\n        was reduced. The whole team fears they will be next.&nbsp; If you have\n        already implemented: Protection from Outside Distraction, this will\n        eliminate the effect.\n      </p>\n    ),\n    effect(age, state) {\n      const preparations = selectedActionIds(\n        state,\n        /* before this gremlin ocurred */ (round) =>\n          round.gremlin === 'GREMLIN_MANAGEMENT_YELLS',\n      );\n\n      let name = 'Management yells at a team member in public';\n      if (preparations.includes('PROTECTED_FROM_OUTSIDE_DISTRACTION')) {\n        return { capacityChange: -1, title: name };\n      }\n      return {\n        capacityChange: -2,\n        title: name,\n      };\n    },\n  },\n  GREMLIN_EMERGENCY_ON_OTHER_TEAM: {\n    probability: () => 10,\n    name: 'Emergency on other team',\n    description: (\n      <p>\n        Your best tester is needed by another team for a while.&nbsp; If you\n        have already implemented: Cross Skilling, External Cross Training or\n        Protection from Outside Distraction, they will reduce effects.\n      </p>\n    ),\n    effect(age, state) {\n      const finishedActionIds = selectedActionIds(state);\n\n      if (\n        age >= 3 ||\n        (finishedActionIds.includes('PROTECTED_FROM_OUTSIDE_DISTRACTION') &&\n          age >= 2)\n      ) {\n        return null;\n      }\n\n      let capacity = -3;\n\n      if (finishedActionIds.includes('CROSS_SKILLING')) {\n        capacity += 1;\n      }\n      if (finishedActionIds.includes('EXTERNAL_CROSS_TRAINING')) {\n        capacity += 1;\n      }\n\n      return {\n        capacityChange: capacity,\n        title:\n          'We’ve had an emergency on another team, we need your best tester for a while.',\n      };\n    },\n  },\n  GREMLIN_NOT_PULLING_THEIR_WEIGHT: {\n    probability: () => 5,\n    name: \"Team member isn't pulling their weight\",\n    description: (\n      <p>\n        One of the people on your team isn’t pulling their weight - not even\n        close. However, nothing seems to get done about it. The rest of the team\n        is pulling together and taking this person’s work on, but it’s harming\n        morale and productivity. &nbsp; If you have already implemented: A\n        ScrumMaster conducts one on ones - you will be working on the problem\n        already; Cross Skilling - the problem person is more likely to grow\n        because they see others and learn from them.\n      </p>\n    ),\n    effect(age, state) {\n      const finishedActionIds = selectedActionIds(state);\n\n      let capacityChange = -2;\n      if (\n        finishedActionIds.includes('ONE_ON_ONES') ||\n        finishedActionIds.includes('CROSS_SKILLING')\n      ) {\n        capacityChange = -1;\n      }\n      return {\n        capacityChange: capacityChange,\n        title: \"Team member isn't pulling their weight\",\n      };\n    },\n  },\n  GREMLIN_NOT_AT_DAILY_SCRUM: {\n    probability: () => 10,\n    name: 'Team Member consistently late or misses Daily Scrum',\n    description: (\n      <p>\n        When one team member is consistently late - or, worse, missing - they\n        signal disrespect to their team. Other team members are annoyed that\n        this person does that to them. &nbsp; ScrumMaster Conducts One on Ones -\n        you will become aware of the problem early; Working Agreements - empower\n        team members to raise the issue.\n      </p>\n    ),\n    effect(age, state) {\n      const finishedActionIds = selectedActionIds(state);\n\n      let capacityChange = -1;\n      if (\n        finishedActionIds.includes('ONE_ON_ONES') ||\n        finishedActionIds.includes('WORKING_AGREEMENTS')\n      ) {\n        capacityChange = 0;\n      }\n      return {\n        capacityChange: capacityChange,\n        title: 'Team Member consistently late or misses Daily Scrum',\n      };\n    },\n  },\n  GREMLIN_NEW_STORY_MID_SPRINT: {\n    probability: () => 5,\n    name: 'PO discovers a new Emergency Story Mid-Sprint',\n    description: (\n      <p>\n        The Team is in the middle of a Sprint, but the Product Owner has\n        discovered unplanned work and interrupts their flow mid-Sprint to deal\n        with it because it’s now “high-priority.” &nbsp; Teams that particpate\n        in regular Product Backlog Refinment avoid this problem because they\n        continually stay up to date on the Product Owners needs\n      </p>\n    ),\n    effect(age, state) {\n      const finishedActionIds = selectedActionIds(state);\n\n      if (\n        finishedActionIds.includes('BACKLOG_REFINEMENT') &&\n        finishedActionIds.includes('STORY_MAPPING_OR_OTHER')\n      ) {\n        return {\n          capacityChange: 0,\n          userStoryChange: 0,\n          title:\n            'Emergency Story Mid-Sprint effect avoided by the combined effect of Ongoing Backlog Refinement and good Strategic work with the Product Owner',\n        };\n      }\n\n      if (age === 0) {\n        if (\n          finishedActionIds.includes('BACKLOG_REFINEMENT') ||\n          finishedActionIds.includes('STORY_MAPPING_OR_OTHER')\n        ) {\n          return {\n            capacityChange: -1,\n            userStoryChange: -10,\n            title:\n              'Emergency Story Mid-Sprint effect reduce by either the effect of Ongoing Backlog Refinement or good Strategic work with the Product Owner',\n          };\n        }\n\n        return {\n          capacityChange: -2,\n          userStoryChange: -10,\n          title: 'Emergency Story Mid-Sprint is hurting',\n        };\n      }\n\n      return {\n        capacityChange: 0,\n        userStoryChange: 0,\n        title: 'Emergency Story Mid-Sprint -> Emergency over',\n      };\n    },\n  },\n  GREMLIN_PRODUCT_BACKLOG_MESS: {\n    probability: () => 5,\n    name: 'Product Backlog has become a quagmire',\n    description: (\n      <p>\n        The Product Backlog has become a large difficult to manage mess. Items\n        sometimes get lost. &nbsp; Teams that particpate in regular Product\n        Backlog Refinment or Story Mapping reduce this problem because they work\n        with Product Owners to keep more manageable. Teams that Limit Product\n        Backlog size avoid this problem altogether.\n      </p>\n    ),\n    effect(age, state) {\n      const finishedActionIds = selectedActionIds(state);\n\n      let additionalComment = '';\n      let capacityChange = -1;\n      let userStoryChange = -20;\n      if (\n        finishedActionIds.includes('STORY_MAPPING_OR_OTHER') ||\n        finishedActionIds.includes('BACKLOG_REFINEMENT')\n      ) {\n        userStoryChange = -10;\n        additionalComment =\n          '- Story Mapping or Backlog Refinement reduce the effect';\n      }\n      if (finishedActionIds.includes('WORK_WITH_PO_LIMIT_PB_SIZE')) {\n        capacityChange = 0;\n        userStoryChange = 0;\n        additionalComment =\n          '- avoided because the team that Limited Product Backlog size';\n      }\n      return {\n        capacityChange: capacityChange,\n        userStoryChange: userStoryChange,\n        title: 'Large Product Backlog ' + additionalComment,\n      };\n    },\n  },\n  GREMLIN_SKIP_RETRO: {\n    probability: () => 10,\n    name: 'Team decide to skip Retrospective',\n    description: (\n      <p>\n        Teams skip retrospectives when they percieve the activity is boring or\n        believe that improvements don't happen. &nbsp; Changing the\n        Retrospective Agenda; Making Retrospective items more concrete all avoid\n        the problem\n      </p>\n    ),\n    effect(age, state) {\n      const finishedActionIds = selectedActionIds(state);\n\n      if (\n        finishedActionIds.includes('IMPROVE_RETROSPECTIVES_CHANGE_AGENDA') ||\n        finishedActionIds.includes('IMPROVE_RETROSPECTIVES_CONCRETE_ACTIONS')\n      ) {\n        return {\n          capacityChange: 0,\n          title: 'Retrospective skipped - problem avoided',\n        };\n      }\n      let capacityChange = -age;\n      if (age >= 4) {\n        capacityChange = -4;\n      }\n      return {\n        capacityChange: capacityChange,\n        title: 'Retrospective skipped',\n      };\n    },\n  },\n  GREMLIN_POOR_QUALITY: {\n    probability: () => 10,\n    name: 'Poor Quality',\n    description: (\n      <p>\n        Our code base has a number of defects. As we try to add features we get\n        bogged down, in dealing with the cascade of errors. In addition the\n        quality makes it harder to build the feaures that the Product Owner has\n        asked for. &nbsp; Teams that practice TDD, BDD and/or Pair Programming\n        suffer this effect less.\n      </p>\n    ),\n    effect(age, state) {\n      const finishedActionIds = selectedActionIds(state);\n\n      let additionalComment = '';\n      let capacityChange = -3;\n      let userStoryChange = -15;\n      if (\n        finishedActionIds.includes('TEST_DRIVEN_DEVELOPMENT') ||\n        finishedActionIds.includes('PAIR_PROGRAMMING')\n      ) {\n        capacityChange = -2;\n        userStoryChange = -10;\n        additionalComment = '- TDD or Pair Programming Reduce the effect';\n      }\n      if (\n        finishedActionIds.includes('TEST_DRIVEN_DEVELOPMENT') &&\n        finishedActionIds.includes('PAIR_PROGRAMMING')\n      ) {\n        capacityChange = -1;\n        userStoryChange = -5;\n        additionalComment =\n          '- TDD and Pair Programming Reduce elimintate the effect';\n      }\n\n      if (finishedActionIds.includes('ADOPT_BDD')) {\n        capacityChange = -1;\n        userStoryChange = -5;\n        additionalComment = '- BDD Reduced the effect';\n      }\n      return {\n        capacityChange: capacityChange,\n        userStoryChange: userStoryChange,\n        title: 'Poor quality ' + additionalComment,\n      };\n    },\n  },\n  GREMLIN_UNREADABLE_CODE: {\n    probability: () => 10,\n    name: 'Unreadable Code',\n    description: (\n      <p>\n        Code base is becoming harder and harder to read. As it becomes harder to\n        read, it takes more time to add new features. In addition messier code\n        often contains more bugs. &nbsp; Teams that practice TDD and/or Pair\n        Programming suffer this effect less.\n      </p>\n    ),\n    effect(age, state) {\n      const finishedActionIds = selectedActionIds(state);\n\n      let additionalComment = '';\n      let capacityChange = -2;\n      if (\n        finishedActionIds.includes('TEST_DRIVEN_DEVELOPMENT') ||\n        finishedActionIds.includes('PAIR_PROGRAMMING')\n      ) {\n        capacityChange = -1;\n        additionalComment = '- TDD or Pair Programming Reduce the effect';\n      }\n      if (\n        finishedActionIds.includes('TEST_DRIVEN_DEVELOPMENT') &&\n        finishedActionIds.includes('PAIR_PROGRAMMING')\n      ) {\n        capacityChange = 0;\n        additionalComment =\n          '- TDD and Pair Programming Reduce elimintate the effect';\n      }\n      return {\n        capacityChange: capacityChange,\n        title: 'Unreadable code ' + additionalComment,\n      };\n    },\n  },\n};\n","import type { GameConfig } from '../state';\nimport type { GameActionId } from './rounds';\nimport type { GremlinId } from './gremlins';\nimport { rounds } from './rounds';\nimport { gremlins } from './gremlins';\nimport { gameEffects } from './gameEffects';\n\nexport type { GameActionId } from './rounds';\nexport type { GremlinId } from './gremlins';\n\nconst INITIAL_CAPACITY = 10;\nconst INITIAL_USER_STORY_CHANCE = 30;\nconst INITIAL_GREMLIN_CHANCE = 0;\nconst TRAILING_ROUNDS = 6;\n\nexport const config: GameConfig<GameActionId, GremlinId> = {\n  initialScores: {\n    capacityChange: INITIAL_CAPACITY,\n    userStoryChange: INITIAL_USER_STORY_CHANCE,\n    gremlinChange: INITIAL_GREMLIN_CHANCE,\n  },\n  rounds,\n  gremlins,\n  gameEffects,\n  trailingRounds: TRAILING_ROUNDS,\n};\n","import type { GameEffect } from '../../state';\nimport type { GameActionId } from '../rounds';\nimport type { GremlinId } from '../gremlins';\nimport { rounds as roundConfigs } from '../rounds';\nimport { findGameActionById } from '../../lib';\n\nexport const gameEffects: {\n  [key: string]: GameEffect<GameActionId, GremlinId>;\n} = {\n  technicalDebtDrag(rounds) {\n    let roundsWithoutEngAction = 0;\n\n    for (const round of rounds) {\n      const roundsGameActions = round.selectedGameActionIds.map((id) =>\n        findGameActionById(id, roundConfigs),\n      );\n      const engineeringAction = roundsGameActions.find(\n        ({ type }) => type === 'ENGINEERING',\n      );\n\n      if (engineeringAction) {\n        break;\n      }\n\n      roundsWithoutEngAction += 1;\n    }\n\n    if (roundsWithoutEngAction === 0) {\n      return null;\n    }\n\n    return {\n      capacityChange: -roundsWithoutEngAction,\n      title: 'TechnicalDebt Drag Effect',\n      description: `No Engineering improvement for ${roundsWithoutEngAction} round${\n        roundsWithoutEngAction > 1 ? 's' : ''\n      }`,\n    };\n  },\n  communicationDebtDrag(rounds) {\n    let roundsWithoutCommunicationAction = 0;\n\n    for (const round of rounds) {\n      const roundsGameActions = round.selectedGameActionIds.map((id) =>\n        findGameActionById(id, roundConfigs),\n      );\n      const communicationAction = roundsGameActions.find(\n        ({ type }) => type === 'COMMUNICATION',\n      );\n\n      if (communicationAction) {\n        break;\n      }\n\n      roundsWithoutCommunicationAction += 1;\n    }\n\n    if (roundsWithoutCommunicationAction === 0) {\n      return null;\n    }\n\n    return {\n      capacityChange: -roundsWithoutCommunicationAction,\n      title: 'Communication Drag Effect Title',\n      description: `No Communication improvement for ${roundsWithoutCommunicationAction} round${\n        roundsWithoutCommunicationAction > 1 ? 's' : ''\n      }`,\n    };\n  },\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './app';\nimport { getInitialState } from './lib';\nimport { config } from './config';\n\nif (\n  process.env.NODE_ENV !== 'production' &&\n  window.location.pathname.match(/^\\/results/)\n) {\n  import('./simulate/ResultsApp').then(({ default: App }) => {\n    ReactDOM.render(\n      <React.StrictMode>\n        <App />\n      </React.StrictMode>,\n      document.getElementById('root'),\n    );\n  });\n} else {\n  getInitialState().then((initialState) => {\n    ReactDOM.render(\n      <React.StrictMode>\n        <App initialState={initialState} config={config} />\n      </React.StrictMode>,\n      document.getElementById('root'),\n    );\n  });\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"actionList\":\"Log_actionList__K1QW8\",\"actionImage\":\"Log_actionImage__1zuHZ\",\"roundList\":\"Log_roundList__irhf8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"tabs\":\"Tabs_tabs__1kRJb\",\"tab\":\"Tabs_tab__l3ga7\",\"tabActive\":\"Tabs_tabActive__23Wy-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"Button_button__3yE9C\",\"primary\":\"Button_primary__OYOHd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"review\":\"Container_review__3moju\",\"reviewHint\":\"Container_reviewHint__3JY6V\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"rows\":\"Rows_rows__1a8gr\",\"row\":\"Rows_row__3x2Ty\"};"],"sourceRoot":""}